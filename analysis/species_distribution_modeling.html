<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.269">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Species Distribution Modeling</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="species_distribution_modeling_files/libs/clipboard/clipboard.min.js"></script>
<script src="species_distribution_modeling_files/libs/quarto-html/quarto.js"></script>
<script src="species_distribution_modeling_files/libs/quarto-html/popper.min.js"></script>
<script src="species_distribution_modeling_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="species_distribution_modeling_files/libs/quarto-html/anchor.min.js"></script>
<link href="species_distribution_modeling_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="species_distribution_modeling_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="species_distribution_modeling_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="species_distribution_modeling_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="species_distribution_modeling_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Species Distribution Modeling</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<p>I am modeling the distributions of the four <em>Enyalius</em> study species (<em>E. catenatus</em>, <em>E. pictus</em>, <em>E. perditus</em>, and <em>E. iheringii</em>) to understand their current distributions and responses to long-term historical climate change.</p>
<p>I will build robust models of their current distributions using recent environmental data (i.e.&nbsp;last few decades). Then, I will build similar models with variables that are available for both present-day and historical (i.e.&nbsp;last glacial maximum) time periods. I will use the <strong>current</strong> models as benchmarks for the performance of the models intended for hindcasting.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(spThin)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(janitor)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(here)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rasterVis)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ENMeval)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(terra)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(usdm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="current" class="level1">
<h1>Current</h1>
<section id="variable-selection" class="level2">
<h2 class="anchored" data-anchor-id="variable-selection">Variable selection</h2>
<p>I’m choosing variables that encompass the range of the <em>Enyalius</em> species, are relevant to their physiology, and are obtainable at a reasonable spatial resolution.</p>
<p>Bioclims:<br>
Using the BrazilClim dataset downloaded from Ramoni-Perazzi, P., Passamani, M., Thielen, D., Padovani, C., Arizapana-Almonacid, M.A., 2021. BrazilClim : The overcoming of limitations of pre‐existing bioclimate data. Int. J. Climatol. https://doi.org/10.1002/joc.7325. Downloaded on <strong>2022-02-25</strong>.<br>
1 km resolution.</p>
<p>For projecting to past climates, I’m using <a href="https://cp.copernicus.org/preprints/cp-2021-30/cp-2021-30.pdf">CHELSA TraCE21k v1.0 Bioclims</a> at 100-year intervals back to the LGM. 1 km resolution. <strong>Not downloaded yet- need to fill this in when it happens</strong></p>
<p>Land Cover:<br>
Using biome projections from <a href="https://onlinelibrary-wiley-com.ezproxy.gc.cuny.edu/doi/full/10.1111/geb.12694">Costa et al.&nbsp;2018</a> at 1000-year intervals back to the LGM. 5 km resolution that I’m downscaling with nearest-neighbor resampling. Downloaded on <strong>2023-06-08</strong>.</p>
</section>
<section id="variable-processing" class="level2">
<h2 class="anchored" data-anchor-id="variable-processing">Variable processing</h2>
<p>I’m cropping the variables to a relevant extent before going further with the individual SDMs. I’m cropping them with a 1 degree buffer around the entire species group’s range.</p>
<p>First, I’m reading in the localities and plotting them to make sure there isn’t anything wild. Everything looks reasonable!</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># read in as a data frame first</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>locs_df <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="fu">here</span>(<span class="st">"analysis"</span>, <span class="st">"data"</span>, <span class="st">"enyalius_locs.csv"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># the variable names are messy</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>  janitor<span class="sc">::</span><span class="fu">clean_names</span>() <span class="sc">%&gt;%</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(latitude), <span class="sc">!</span><span class="fu">is.na</span>(longitude)) <span class="sc">%&gt;%</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># there are some lat/longs with spaces. Need to fix this</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">longitude =</span> <span class="fu">str_remove</span>(longitude, <span class="st">"</span><span class="sc">\\</span><span class="st">s"</span>), </span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">latitude =</span> <span class="fu">str_remove</span>(latitude, <span class="st">"</span><span class="sc">\\</span><span class="st">s"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># convert to numeric</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">longitude =</span> <span class="fu">as.numeric</span>(longitude),</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>         <span class="at">latitude =</span> <span class="fu">as.numeric</span>(latitude))</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a><span class="co"># convert to sf for spatial operations</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>locs_sf <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(locs_df, </span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>                    <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"longitude"</span>, <span class="st">"latitude"</span>),</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>                    <span class="at">crs =</span> <span class="dv">4326</span>)</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a><span class="co"># convert to vect for interacting with terra</span></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>locs_vec <span class="ot">&lt;-</span> <span class="fu">vect</span>(locs_sf)</span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a><span class="co"># atlantic forest shapefile for plotting</span></span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>af <span class="ot">&lt;-</span> <span class="fu">read_sf</span>(<span class="fu">here</span>(<span class="st">"analysis"</span>, <span class="st">"data"</span>, <span class="st">"atlantic_forest"</span>, <span class="st">"atlantic_forest.geojson"</span>))</span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a><span class="co"># plot</span></span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> <span class="fu">st_geometry</span>(af), <span class="at">fill =</span> <span class="st">"gray"</span>) <span class="sc">+</span></span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> locs_sf, <span class="fu">aes</span>(<span class="at">fill =</span> species), <span class="at">shape =</span> <span class="dv">21</span>) <span class="sc">+</span></span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_d</span>() <span class="sc">+</span></span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Creating a convex hull with an 2 degree buffer.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>mcp_all <span class="ot">&lt;-</span> <span class="fu">st_convex_hull</span>(<span class="fu">st_union</span>(locs_sf)) <span class="sc">%&gt;%</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_buffer</span>(<span class="at">dist =</span> units<span class="sc">::</span><span class="fu">set_units</span>(<span class="dv">2</span>, degree)) <span class="sc">%&gt;%</span> </span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  terra<span class="sc">::</span><span class="fu">vect</span>()</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(af))</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(mcp_all, <span class="at">add=</span><span class="cn">TRUE</span>)</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(locs_vec, <span class="at">add=</span><span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Read in bioclims. Originally I waited to crop, but I folded that into the initial variable downloads. The rasters going into <code>cropped_predictors</code> are the same as I’m reading in, just with different names. They’re also being written as a single file, rather than multiple files.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>bioclims <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">rast</span>(<span class="fu">list.files</span>(<span class="fu">here</span>(<span class="st">"analysis"</span>, <span class="st">"data"</span>, <span class="st">"current_climate_chelsa"</span>), <span class="at">full.names =</span> <span class="cn">TRUE</span>))</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="co"># get the only the bioclim labels</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(bioclims) <span class="ot">&lt;-</span> <span class="fu">str_extract</span>(<span class="fu">names</span>(bioclims), <span class="st">"bio[</span><span class="sc">\\</span><span class="st">d+]*"</span>)</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(bioclims<span class="sc">$</span>bio1)</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(af), <span class="at">add=</span><span class="cn">TRUE</span>)</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(mcp_all, <span class="at">add=</span><span class="cn">TRUE</span>)</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(locs_vec, <span class="at">add=</span><span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Crop the present-day biome layer and convert it to a binary variable, where 1 is the presence of tropical moist forest and 0 is the absence of tropical moist forest.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>forest_cover <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">rast</span>(<span class="fu">here</span>(<span class="st">"analysis"</span>, <span class="st">"data"</span>, <span class="st">"biomes"</span>, <span class="st">"S1biomes_0k.asc"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aggregate</span>(<span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  terra<span class="sc">::</span><span class="fu">crop</span>(mcp_all) <span class="sc">%&gt;%</span> </span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  terra<span class="sc">::</span><span class="fu">mask</span>(mcp_all) </span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>forest_cover[forest_cover <span class="sc">!=</span> <span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(forest_cover) <span class="ot">&lt;-</span> <span class="st">"forest_cover"</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(forest_cover)</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(af), <span class="at">add=</span><span class="cn">TRUE</span>)</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(mcp_all, <span class="at">add=</span><span class="cn">TRUE</span>)</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(locs_vec, <span class="at">add=</span><span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Write the cropped climate and forest cover layers to file for use in the SDMs.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>terra<span class="sc">::</span><span class="fu">writeRaster</span>(bioclims, <span class="fu">here</span>(<span class="st">"analysis"</span>, <span class="st">"output"</span>, <span class="st">"cropped_predictors"</span>, <span class="st">"bioclims.tif"</span>))</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>terra<span class="sc">::</span><span class="fu">writeRaster</span>(forest_cover, <span class="fu">here</span>(<span class="st">"analysis"</span>, <span class="st">"output"</span>, <span class="st">"cropped_predictors"</span>, <span class="st">"forest_cover.tif"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="general-sdm-steps" class="level2 tabset">
<h2 class="tabset anchored" data-anchor-id="general-sdm-steps">General SDM steps</h2>
<p>For each SDM, I’m going to perform the following steps:</p>
<pre><code>- spatially thin localities  
- crop the new predictors according to a minimum convex hull of the localities for each species with a 0.5 degree buffer 
    - I tried point-buffers, but they resulted in worse models
- extract background environmental data (10,000 points) for predictor correlation and modeling
- correlate predictors
- remove predictors w/ r &gt; 0.75, prioritizing ecologically relevant variables  
- Use Maxent for modeling
    - LQH feature classes to keep models relatively simple  
    - regularization multipliers from 0.5 to 5.0 in 0.5 increments to test a wide range of regularization
    - leave-one-out cross validation for model selection due to a low number of localities
    - select models first by AICc (model fit), followed by ommission error rate (prediction)  </code></pre>
<p>In addition, I’m reading/writing data for each species in isolation, so the code for one species isn’t dependent on that for another, or for what I did during variable processing.</p>
<section id="e.-catenatus" class="level3">
<h3 class="anchored" data-anchor-id="e.-catenatus">E. catenatus</h3>
<p>Note: putative “catenatus 2” species from Mariana’s phylogenetic work have been removed.</p>
<p>Reading in data for plotting.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># atlantic forest shapefile</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>af <span class="ot">&lt;-</span> <span class="fu">read_sf</span>(<span class="fu">here</span>(<span class="st">"analysis"</span>, <span class="st">"data"</span>, <span class="st">"atlantic_forest"</span>, <span class="st">"atlantic_forest.geojson"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="spatial-thin" class="level4">
<h4 class="anchored" data-anchor-id="spatial-thin">Spatial thin</h4>
<p>Read and filter localities.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>locs_cat <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="fu">here</span>(<span class="st">"analysis"</span>, <span class="st">"data"</span>, <span class="st">"enyalius_locs.csv"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># the variable names are messy</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  janitor<span class="sc">::</span><span class="fu">clean_names</span>() <span class="sc">%&gt;%</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(species <span class="sc">==</span> <span class="st">"catenatus"</span>,</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>    <span class="sc">!</span><span class="fu">is.na</span>(latitude), <span class="sc">!</span><span class="fu">is.na</span>(longitude),</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># remove duplicates</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>    <span class="sc">!</span><span class="fu">duplicated</span>(latitude)) <span class="sc">%&gt;%</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># there are some lat/longs with spaces. Need to fix this</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">longitude =</span> <span class="fu">str_remove</span>(longitude, <span class="st">"</span><span class="sc">\\</span><span class="st">s"</span>), </span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>         <span class="at">latitude =</span> <span class="fu">str_remove</span>(latitude, <span class="st">"</span><span class="sc">\\</span><span class="st">s"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># convert to numeric</span></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">longitude =</span> <span class="fu">as.numeric</span>(longitude),</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>         <span class="at">latitude =</span> <span class="fu">as.numeric</span>(latitude)) <span class="sc">%&gt;%</span> </span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># one locality falls into the ocean when using the aggregated data. Have to scooch it over by 0.05 degrees to overlap with the correct cell</span></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">longitude =</span> <span class="fu">if_else</span>(longitude <span class="sc">==</span> <span class="sc">-</span><span class="fl">39.06</span>, longitude <span class="sc">-</span> <span class="fl">0.05</span>, longitude)) <span class="sc">%&gt;%</span> </span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>  <span class="co"># convert to sf for spatial operations</span></span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_as_sf</span>(<span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"longitude"</span>, <span class="st">"latitude"</span>),</span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>           <span class="at">crs =</span> <span class="dv">4326</span>,</span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>           <span class="at">remove =</span> <span class="cn">FALSE</span>)</span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a><span class="co"># plot localities</span></span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(af))</span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(locs_cat), <span class="at">add =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="species_distribution_modeling_files/figure-html/locs-cat-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Spatial thin. I’m using a 20 km buffer to reduce the impact of spatial autocorrelation.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">394833</span>)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="co">#run spthin algorithm. This returns 100 possible combinations of removed localities</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>output <span class="ot">&lt;-</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>  spThin<span class="sc">::</span><span class="fu">thin</span>(</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    locs_cat,</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">'latitude'</span>,</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">'longitude'</span>,</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">'species'</span>,</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">thin.par =</span> <span class="dv">20</span>,</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">reps =</span> <span class="dv">100</span>,</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">locs.thinned.list.return =</span> <span class="cn">TRUE</span>,</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">write.files =</span> <span class="cn">FALSE</span>,</span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">verbose =</span> <span class="cn">FALSE</span></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a><span class="co"># I want to maximize the # of localities returned  </span></span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>maxThin <span class="ot">&lt;-</span> <span class="fu">which</span>(<span class="fu">sapply</span>(output, nrow) <span class="sc">==</span> <span class="fu">max</span>(<span class="fu">sapply</span>(output, nrow)))</span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a><span class="co"># if there are multiple iterations with the max # of localities, pick one</span></span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a>maxThin <span class="ot">&lt;-</span></span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a>  output[[<span class="fu">ifelse</span>(<span class="fu">length</span>(maxThin) <span class="sc">&gt;</span> <span class="dv">1</span>, maxThin[<span class="dv">1</span>], maxThin)]]</span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a><span class="co"># subset locs to match only thinned locs</span></span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a>locs_cat <span class="ot">&lt;-</span> locs_cat[<span class="fu">as.numeric</span>(<span class="fu">rownames</span>(maxThin)), ]</span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a><span class="co"># get the unused locs as a testing data set</span></span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a><span class="co"># this probably isn't useful since they will overlap heavily with the training data, but seems like another piece of info to look at</span></span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a>test_cat <span class="ot">&lt;-</span> locs_cat[<span class="sc">-</span><span class="fu">as.numeric</span>(<span class="fu">rownames</span>(maxThin)), ]</span>
<span id="cb10-30"><a href="#cb10-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-31"><a href="#cb10-31" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(af))</span>
<span id="cb10-32"><a href="#cb10-32" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(locs_cat), <span class="at">add=</span><span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="species_distribution_modeling_files/figure-html/spthin-cat-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Write thinned localities to file</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Write to file</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="fu">st_write</span>(locs_cat, <span class="fu">here</span>(<span class="st">"analysis"</span>, <span class="st">"output"</span>, <span class="st">"thinned_localities"</span>, <span class="st">"catenatus_thinned.gpkg"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="crop-environment" class="level4">
<h4 class="anchored" data-anchor-id="crop-environment">Crop environment</h4>
<p>First, I need to read in the environmental data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>bioclims <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">rast</span>(<span class="fu">here</span>(<span class="st">"analysis"</span>, <span class="st">"output"</span>, <span class="st">"cropped_predictors"</span>, <span class="st">"bioclims.tif"</span>))</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>forest_cover <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">rast</span>(<span class="fu">here</span>(<span class="st">"analysis"</span>, <span class="st">"output"</span>, <span class="st">"cropped_predictors"</span>, <span class="st">"forest_cover.tif"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Cropping and combining variables for analysis.</p>
<div>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># for projection</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>mcp_cat <span class="ot">&lt;-</span> <span class="fu">st_convex_hull</span>(<span class="fu">st_union</span>(locs_cat)) <span class="sc">%&gt;%</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_buffer</span>(<span class="at">dist =</span> units<span class="sc">::</span><span class="fu">set_units</span>(<span class="fl">0.5</span>, degree)) <span class="sc">%&gt;%</span> </span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>  terra<span class="sc">::</span><span class="fu">vect</span>()</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>bioclims_cat <span class="ot">&lt;-</span> bioclims <span class="sc">%&gt;%</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># the bioclims are in a slightly different CRS</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>  terra<span class="sc">::</span><span class="fu">project</span>(forest_cover) <span class="sc">%&gt;%</span> </span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>  terra<span class="sc">::</span><span class="fu">crop</span>(mcp_cat) <span class="sc">%&gt;%</span> </span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>  terra<span class="sc">::</span><span class="fu">mask</span>(mcp_cat)</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>forest_cover_cat <span class="ot">&lt;-</span> forest_cover <span class="sc">%&gt;%</span> </span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>  terra<span class="sc">::</span><span class="fu">crop</span>(bioclims_cat) <span class="sc">%&gt;%</span> </span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>  terra<span class="sc">::</span><span class="fu">mask</span>(bioclims_cat[[<span class="dv">1</span>]]) </span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>predictors_cat <span class="ot">&lt;-</span> <span class="fu">c</span>(bioclims_cat)</span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(bioclims_cat[[<span class="dv">1</span>]])</span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(forest_cover_cat)</span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(locs_cat, <span class="at">add=</span><span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell quarto-layout-panel">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="species_distribution_modeling_files/figure-html/crop-cat-1.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="species_distribution_modeling_files/figure-html/crop-cat-2.png" class="img-fluid" width="672"></p>
</div>
</div>
</div>
</div>
</section>
<section id="predictor-correlation" class="level4">
<h4 class="anchored" data-anchor-id="predictor-correlation">Predictor correlation</h4>
<p>Sample 10000 background points. Only returned 2355 points.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1988888</span>)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="co"># for variable correlations</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>bg_envt_cat <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">spatSample</span>(predictors_cat, <span class="dv">10000</span>, </span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>                               <span class="at">warn=</span><span class="cn">TRUE</span>, </span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>                               <span class="at">na.rm =</span> <span class="cn">TRUE</span>, </span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>                               <span class="at">as.df =</span> <span class="cn">TRUE</span>,</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>                               <span class="at">xy =</span> <span class="cn">TRUE</span>)</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a><span class="co"># for use in ENMevaluate</span></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>bg_coords_cat <span class="ot">&lt;-</span> bg_envt_cat[,<span class="fu">c</span>(<span class="st">"x"</span>, <span class="st">"y"</span>)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Next, I’ll extract the values for the background points and perform variance inflation factor stepwise selection with a VIF threshold of 10.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># extract values</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>bg_corr_cat <span class="ot">&lt;-</span> bg_envt_cat <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>x, <span class="sc">-</span>y)</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>usdm<span class="sc">::</span><span class="fu">vifstep</span>(bg_corr_cat, <span class="at">th=</span><span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>13 variables from the 19 input variables have collinearity problem: 
 
bio6 bio11 bio10 bio2 bio12 bio5 bio17 bio19 bio1 bio16 bio14 bio7 bio9 

After excluding the collinear variables, the linear correlation coefficients ranges between: 
min correlation ( bio4 ~ bio3 ):  0.00359246 
max correlation ( bio18 ~ bio13 ):  0.6946972 

---------- VIFs of the remained variables -------- 
  Variables      VIF
1     bio13 4.386788
2     bio15 2.593857
3     bio18 2.335780
4      bio3 4.981678
5      bio4 1.094628
6      bio8 1.470134</code></pre>
</div>
</div>
<p>The final variable list: BIO3, BIO4, BIO8, BIO13, BIO15, BIO18</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># label: pred-cat</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>predictors_cat <span class="ot">&lt;-</span> predictors_cat[[<span class="fu">c</span>(<span class="st">"bio3"</span>, <span class="st">"bio4"</span>, <span class="st">"bio8"</span>, <span class="st">"bio13"</span>, <span class="st">"bio15"</span>, <span class="st">"bio18"</span>)]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="maxent-model" class="level4">
<h4 class="anchored" data-anchor-id="maxent-model">Maxent model</h4>
<p>I’m using a jackknifing model evaluation approach since I only have 26 observations and a previous attempt for spatial CV led to wonky evaluation metrics. Additionally, spatial CV can lead to worse predictions than non-spatial CV: <a href="https://www-sciencedirect-com.ezproxy.gc.cuny.edu/science/article/pii/S0304380021002489">Wadoux et al.&nbsp;2021</a>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">7990777</span>)</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>coords_cat <span class="ot">&lt;-</span> <span class="fu">st_coordinates</span>(locs_cat)</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(coords_cat) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"x"</span>, <span class="st">"y"</span>)</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>folds_cat <span class="ot">&lt;-</span> ENMeval<span class="sc">::</span><span class="fu">get.jackknife</span>(<span class="at">occ =</span> coords_cat, </span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>                            <span class="at">bg =</span> bg_coords_cat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Run the model. Predictions are clamped to prevent extrapolation.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">34622</span>)</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="co"># the vector of regularization multipliers to test</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>rms <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="fl">0.5</span>, <span class="dv">5</span>, <span class="fl">0.5</span>)</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a><span class="co"># convert the terra object to a raster stack for use in EMNeval</span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>predictors_cat_stack <span class="ot">&lt;-</span> raster<span class="sc">::</span><span class="fu">stack</span>(predictors_cat)</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a><span class="co"># iterate model building over all chosen parameter settings</span></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>sdm_cat <span class="ot">&lt;-</span></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>  ENMeval<span class="sc">::</span><span class="fu">ENMevaluate</span>(</span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">occs =</span> coords_cat,</span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">envs =</span> predictors_cat_stack,</span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">bg.coords =</span> bg_coords_cat,</span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">RMvalues =</span> rms,</span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">fc =</span> <span class="fu">c</span>(<span class="st">'L'</span>, <span class="st">'LQ'</span>),</span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># clamping to prevent model extrapolation</span></span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">doClamp =</span> <span class="cn">TRUE</span>,</span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">taxon.name =</span> <span class="st">"catenatus"</span>,</span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">partitions =</span> <span class="st">"user"</span>,</span>
<span id="cb19-21"><a href="#cb19-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">user.grp =</span> folds_cat,</span>
<span id="cb19-22"><a href="#cb19-22" aria-hidden="true" tabindex="-1"></a>    bg.grp,</span>
<span id="cb19-23"><a href="#cb19-23" aria-hidden="true" tabindex="-1"></a>    <span class="co">#categoricals = "forest_cover",</span></span>
<span id="cb19-24"><a href="#cb19-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">clamp =</span> <span class="cn">TRUE</span>,</span>
<span id="cb19-25"><a href="#cb19-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">algorithm =</span> <span class="st">"maxent.jar"</span>,</span>
<span id="cb19-26"><a href="#cb19-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">parallel =</span> <span class="cn">TRUE</span>,</span>
<span id="cb19-27"><a href="#cb19-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">numCores =</span> <span class="dv">6</span></span>
<span id="cb19-28"><a href="#cb19-28" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># write the model to file</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="fu">write_rds</span>(sdm_cat, <span class="fu">here</span>(<span class="st">"analysis"</span>, <span class="st">"output"</span>, <span class="st">"sdm_models"</span>, <span class="st">"sdm_catenatus.rds"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">

</div>
<section id="model-evaluation" class="level5">
<h5 class="anchored" data-anchor-id="model-evaluation">Model evaluation</h5>
<p>Let’s take a look at the model results.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>eval_table_cat <span class="ot">&lt;-</span> sdm_cat<span class="sc">@</span>results</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>eval_mods_cat <span class="ot">&lt;-</span> sdm_cat<span class="sc">@</span>models</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(eval_mods_cat) <span class="ot">&lt;-</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str_replace_all</span>(<span class="fu">names</span>(eval_mods_cat), <span class="st">"</span><span class="sc">\\</span><span class="st">."</span>, <span class="st">"</span><span class="sc">\\</span><span class="st">_"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Select the final model. First I’m looking at plots of model evaluation stats to get an idea of the spread of stats.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>daic_cat <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> eval_table_cat, <span class="fu">aes</span>(<span class="at">x =</span> rm, <span class="at">y =</span> delta.AICc, <span class="at">color =</span> fc)) <span class="sc">+</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_viridis_d</span>() <span class="sc">+</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>or_cat <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> eval_table_cat, <span class="fu">aes</span>(<span class="at">x =</span> rm, <span class="at">y =</span> or<span class="fl">.10</span>p.avg, <span class="at">color =</span> fc)) <span class="sc">+</span></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_viridis_d</span>() <span class="sc">+</span></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>dauc_cat <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> eval_table_cat, <span class="fu">aes</span>(<span class="at">x =</span> rm, <span class="at">y =</span> auc.diff.avg, <span class="at">color =</span> fc)) <span class="sc">+</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_viridis_d</span>() <span class="sc">+</span></span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a>(daic_cat <span class="sc">+</span> or_cat) <span class="sc">/</span> (dauc_cat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="species_distribution_modeling_files/figure-html/eval-met-cat-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Now I’m going to take a look at tables of delta AICc, omission rate, and AUC to see how close the models are. The model with the lowest AICc has a regularization multiplier of 1 and L feature class.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>eval_table_cat <span class="sc">%&gt;%</span> </span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(delta.AICc, AICc, or<span class="fl">.10</span>p.avg, or.mtp.avg, auc.diff.avg, auc.val.avg, rm, fc) <span class="sc">%&gt;%</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(delta.AICc) <span class="sc">%&gt;%</span> </span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">10</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>  knitr<span class="sc">::</span><span class="fu">kable</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped">
<colgroup>
<col style="width: 14%">
<col style="width: 12%">
<col style="width: 14%">
<col style="width: 14%">
<col style="width: 17%">
<col style="width: 16%">
<col style="width: 5%">
<col style="width: 4%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: right;">delta.AICc</th>
<th style="text-align: right;">AICc</th>
<th style="text-align: right;">or.10p.avg</th>
<th style="text-align: right;">or.mtp.avg</th>
<th style="text-align: right;">auc.diff.avg</th>
<th style="text-align: right;">auc.val.avg</th>
<th style="text-align: left;">rm</th>
<th style="text-align: left;">fc</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">0.0000000</td>
<td style="text-align: right;">308.7252</td>
<td style="text-align: right;">0.1363636</td>
<td style="text-align: right;">0.0454545</td>
<td style="text-align: right;">0.1723385</td>
<td style="text-align: right;">0.8128161</td>
<td style="text-align: left;">0.5</td>
<td style="text-align: left;">L</td>
</tr>
<tr class="even">
<td style="text-align: right;">0.3292020</td>
<td style="text-align: right;">309.0544</td>
<td style="text-align: right;">0.1818182</td>
<td style="text-align: right;">0.0454545</td>
<td style="text-align: right;">0.1725600</td>
<td style="text-align: right;">0.8119668</td>
<td style="text-align: left;">1</td>
<td style="text-align: left;">L</td>
</tr>
<tr class="odd">
<td style="text-align: right;">0.8594879</td>
<td style="text-align: right;">309.5847</td>
<td style="text-align: right;">0.1818182</td>
<td style="text-align: right;">0.0454545</td>
<td style="text-align: right;">0.1720104</td>
<td style="text-align: right;">0.8117738</td>
<td style="text-align: left;">1.5</td>
<td style="text-align: left;">L</td>
</tr>
<tr class="even">
<td style="text-align: right;">1.5825323</td>
<td style="text-align: right;">310.3078</td>
<td style="text-align: right;">0.1818182</td>
<td style="text-align: right;">0.0454545</td>
<td style="text-align: right;">0.1719001</td>
<td style="text-align: right;">0.8108280</td>
<td style="text-align: left;">2</td>
<td style="text-align: left;">L</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2.4938608</td>
<td style="text-align: right;">311.2191</td>
<td style="text-align: right;">0.1818182</td>
<td style="text-align: right;">0.0909091</td>
<td style="text-align: right;">0.1733183</td>
<td style="text-align: right;">0.8090137</td>
<td style="text-align: left;">2.5</td>
<td style="text-align: left;">L</td>
</tr>
<tr class="even">
<td style="text-align: right;">3.8876490</td>
<td style="text-align: right;">312.6129</td>
<td style="text-align: right;">0.1818182</td>
<td style="text-align: right;">0.0909091</td>
<td style="text-align: right;">0.1806197</td>
<td style="text-align: right;">0.8027215</td>
<td style="text-align: left;">2</td>
<td style="text-align: left;">LQ</td>
</tr>
<tr class="odd">
<td style="text-align: right;">4.4632404</td>
<td style="text-align: right;">313.1885</td>
<td style="text-align: right;">0.1818182</td>
<td style="text-align: right;">0.0909091</td>
<td style="text-align: right;">0.1799597</td>
<td style="text-align: right;">0.8027215</td>
<td style="text-align: left;">2.5</td>
<td style="text-align: left;">LQ</td>
</tr>
<tr class="even">
<td style="text-align: right;">6.1840491</td>
<td style="text-align: right;">314.9093</td>
<td style="text-align: right;">0.1363636</td>
<td style="text-align: right;">0.0909091</td>
<td style="text-align: right;">0.1837364</td>
<td style="text-align: right;">0.8018722</td>
<td style="text-align: left;">0.5</td>
<td style="text-align: left;">LQ</td>
</tr>
<tr class="odd">
<td style="text-align: right;">6.4005467</td>
<td style="text-align: right;">315.1258</td>
<td style="text-align: right;">0.1363636</td>
<td style="text-align: right;">0.0454545</td>
<td style="text-align: right;">0.1801325</td>
<td style="text-align: right;">0.8046709</td>
<td style="text-align: left;">1</td>
<td style="text-align: left;">LQ</td>
</tr>
<tr class="even">
<td style="text-align: right;">6.6230754</td>
<td style="text-align: right;">315.3483</td>
<td style="text-align: right;">0.1818182</td>
<td style="text-align: right;">0.0909091</td>
<td style="text-align: right;">0.1744074</td>
<td style="text-align: right;">0.8073152</td>
<td style="text-align: left;">3</td>
<td style="text-align: left;">L</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Select model.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>mod_cat <span class="ot">&lt;-</span> eval_mods_cat<span class="sc">$</span>rm_0_5_fc_L</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>opt_seq_tune_cat <span class="ot">&lt;-</span> <span class="st">"rm.0.5_fc.L"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Plot the variable contributions and response curves. The most important variables are bio15, bio18, and bio13. All precipitation!</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(mod_cat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="species_distribution_modeling_files/figure-html/var-importance-cat-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">png</span>(<span class="st">"variable_contribution_catenatus.png"</span>)</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(mod_cat)</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>()</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a><span class="fu">file.copy</span>(<span class="fu">here</span>(<span class="st">"variable_contribution_catenatus.png"</span>), <span class="fu">here</span>(<span class="st">"analysis"</span>, <span class="st">"output"</span>, <span class="st">"sdm_response_curves_variable_importance"</span>, <span class="st">"variable_contribution_catenatus.png"</span>))</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a><span class="fu">file.remove</span>(<span class="fu">here</span>(<span class="st">"variable_contribution_catenatus.png"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Suitability increases with precipitation amount of the wettest month, decreases with precipitation seasonality, and increases with mean monthly precipitation of the warmest quarter.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>dismo<span class="sc">::</span><span class="fu">response</span>(mod_cat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="species_distribution_modeling_files/figure-html/resp-curve-cat-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">png</span>(<span class="st">"response_curves_catenatus.png"</span>)</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>dismo<span class="sc">::</span><span class="fu">response</span>(mod_cat)</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>()</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="fu">file.copy</span>(<span class="fu">here</span>(<span class="st">"response_curves_catenatus.png"</span>), <span class="fu">here</span>(<span class="st">"analysis"</span>, <span class="st">"output"</span>, <span class="st">"sdm_response_curves_variable_importance"</span>, <span class="st">"response_curves_catenatus.png"</span>))</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a><span class="fu">file.remove</span>(<span class="fu">here</span>(<span class="st">"response_curves_catenatus.png"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="project" class="level5">
<h5 class="anchored" data-anchor-id="project">Project</h5>
<p>I’m projecting the model to the study area extent.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>pred_cat <span class="ot">&lt;-</span> ENMeval<span class="sc">::</span><span class="fu">eval.predictions</span>(sdm_cat)[[opt_seq_tune_cat]]</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(pred_cat)</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(af), <span class="at">add =</span> <span class="cn">TRUE</span>)</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(locs_cat), <span class="at">pch =</span> <span class="dv">21</span>, <span class="at">bg =</span> <span class="fu">alpha</span>(<span class="st">"lightgray"</span>, <span class="fl">0.5</span>), <span class="at">add =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="species_distribution_modeling_files/figure-html/proj-cur-cat-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>pred_cat_thresh <span class="ot">&lt;-</span> pred_cat<span class="sc">$</span>rm.<span class="fl">0.5</span>_fc.L</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="co"># observed suitabilities</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>obs_suit_cat <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">extract</span>(pred_cat<span class="sc">$</span>rm.<span class="fl">0.5</span>_fc.L, locs_cat)</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a><span class="co"># minimum training presence</span></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>min_suit_cat <span class="ot">&lt;-</span> <span class="fu">min</span>(obs_suit_cat)</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>pred_cat_thresh[pred_cat_thresh <span class="sc">&gt;=</span> min_suit_cat] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>pred_cat_thresh[pred_cat_thresh <span class="sc">&lt;</span> min_suit_cat] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(pred_cat_thresh)</span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(af), <span class="at">add =</span> <span class="cn">TRUE</span>)</span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(locs_cat), <span class="at">pch =</span> <span class="dv">21</span>, <span class="at">bg =</span> <span class="fu">alpha</span>(<span class="st">"lightgray"</span>, <span class="fl">0.5</span>), <span class="at">add =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="species_distribution_modeling_files/figure-html/proj-cur-cat-thresh-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
</section>
<section id="e.-pictus" class="level3">
<h3 class="anchored" data-anchor-id="e.-pictus">E. pictus</h3>
<p>Reading in data for plotting.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># atlantic forest shapefile</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>af <span class="ot">&lt;-</span> <span class="fu">read_sf</span>(<span class="fu">here</span>(<span class="st">"analysis"</span>, <span class="st">"data"</span>, <span class="st">"atlantic_forest"</span>, <span class="st">"atlantic_forest.geojson"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="spatial-thin-1" class="level4">
<h4 class="anchored" data-anchor-id="spatial-thin-1">Spatial thin</h4>
<p>Read and filter localities. I’m including the original genetic localities from Mariana and iNaturalist observations I downloaded on 2023-07-10. Citation: GBIF.org (10 July 2023) GBIF Occurrence Download https://doi.org/10.15468/dl.uj2ft2.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>locs_pic <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="fu">here</span>(<span class="st">"analysis"</span>, <span class="st">"data"</span>, <span class="st">"enyalius_locs.csv"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># the variable names are messy</span></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>  janitor<span class="sc">::</span><span class="fu">clean_names</span>() <span class="sc">%&gt;%</span></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(species <span class="sc">==</span> <span class="st">"pictus"</span>,</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>    <span class="sc">!</span><span class="fu">is.na</span>(latitude), <span class="sc">!</span><span class="fu">is.na</span>(longitude),</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># remove duplicates</span></span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>    <span class="sc">!</span><span class="fu">duplicated</span>(latitude)) <span class="sc">%&gt;%</span></span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># there are some lat/longs with spaces. Need to fix this</span></span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">longitude =</span> <span class="fu">str_remove</span>(longitude, <span class="st">"</span><span class="sc">\\</span><span class="st">s"</span>), </span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a>         <span class="at">latitude =</span> <span class="fu">str_remove</span>(latitude, <span class="st">"</span><span class="sc">\\</span><span class="st">s"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># convert to numeric</span></span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">longitude =</span> <span class="fu">as.numeric</span>(longitude),</span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a>         <span class="at">latitude =</span> <span class="fu">as.numeric</span>(latitude)) <span class="sc">%&gt;%</span> </span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># convert to sf for spatial operations</span></span>
<span id="cb32-15"><a href="#cb32-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_as_sf</span>(<span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"longitude"</span>, <span class="st">"latitude"</span>),</span>
<span id="cb32-16"><a href="#cb32-16" aria-hidden="true" tabindex="-1"></a>           <span class="at">crs =</span> <span class="dv">4326</span>,</span>
<span id="cb32-17"><a href="#cb32-17" aria-hidden="true" tabindex="-1"></a>           <span class="at">remove =</span> <span class="cn">FALSE</span>)</span>
<span id="cb32-18"><a href="#cb32-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-19"><a href="#cb32-19" aria-hidden="true" tabindex="-1"></a><span class="co"># read and clean pictus gbif localities</span></span>
<span id="cb32-20"><a href="#cb32-20" aria-hidden="true" tabindex="-1"></a>locs_pic_gbif <span class="ot">&lt;-</span> <span class="fu">read_tsv</span>(<span class="fu">here</span>(<span class="st">"analysis"</span>, <span class="st">"data"</span>, <span class="st">"pictus_gbif.tsv"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb32-21"><a href="#cb32-21" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(</span>
<span id="cb32-22"><a href="#cb32-22" aria-hidden="true" tabindex="-1"></a>    genus, </span>
<span id="cb32-23"><a href="#cb32-23" aria-hidden="true" tabindex="-1"></a>    species, </span>
<span id="cb32-24"><a href="#cb32-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">state =</span> stateProvince,</span>
<span id="cb32-25"><a href="#cb32-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">longitude =</span> decimalLongitude,</span>
<span id="cb32-26"><a href="#cb32-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">latitude =</span> decimalLatitude,</span>
<span id="cb32-27"><a href="#cb32-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">id_code =</span> gbifID</span>
<span id="cb32-28"><a href="#cb32-28" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb32-29"><a href="#cb32-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb32-30"><a href="#cb32-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">species =</span> <span class="fu">str_remove_all</span>(species, <span class="st">"Enyalius "</span>),</span>
<span id="cb32-31"><a href="#cb32-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">id_code =</span> <span class="fu">paste0</span>(<span class="st">"pic_"</span>, id_code)</span>
<span id="cb32-32"><a href="#cb32-32" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb32-33"><a href="#cb32-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_as_sf</span>(</span>
<span id="cb32-34"><a href="#cb32-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"longitude"</span>, <span class="st">"latitude"</span>),</span>
<span id="cb32-35"><a href="#cb32-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">crs =</span> <span class="dv">4326</span>,</span>
<span id="cb32-36"><a href="#cb32-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">remove =</span> <span class="cn">FALSE</span></span>
<span id="cb32-37"><a href="#cb32-37" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb32-38"><a href="#cb32-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-39"><a href="#cb32-39" aria-hidden="true" tabindex="-1"></a><span class="co"># combine the two datasets</span></span>
<span id="cb32-40"><a href="#cb32-40" aria-hidden="true" tabindex="-1"></a>locs_pic <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(</span>
<span id="cb32-41"><a href="#cb32-41" aria-hidden="true" tabindex="-1"></a>  locs_pic, </span>
<span id="cb32-42"><a href="#cb32-42" aria-hidden="true" tabindex="-1"></a>  locs_pic_gbif</span>
<span id="cb32-43"><a href="#cb32-43" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb32-44"><a href="#cb32-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-45"><a href="#cb32-45" aria-hidden="true" tabindex="-1"></a><span class="co"># plot localities</span></span>
<span id="cb32-46"><a href="#cb32-46" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb32-47"><a href="#cb32-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> <span class="fu">st_geometry</span>(af), <span class="at">fill =</span> <span class="st">"darkgreen"</span>) <span class="sc">+</span></span>
<span id="cb32-48"><a href="#cb32-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> locs_pic) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="species_distribution_modeling_files/figure-html/locs-pic-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Spatial thin. I’m using a 20 km buffer. Results in 16 localities.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">888273</span>)</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a><span class="co">#run spthin algorithm. This returns 100 possible combinations of removed localities</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>output <span class="ot">&lt;-</span></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>  spThin<span class="sc">::</span><span class="fu">thin</span>(</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>    locs_pic,</span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">'latitude'</span>,</span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">'longitude'</span>,</span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">'species'</span>,</span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">thin.par =</span> <span class="dv">20</span>,</span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">reps =</span> <span class="dv">100</span>,</span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">locs.thinned.list.return =</span> <span class="cn">TRUE</span>,</span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">write.files =</span> <span class="cn">FALSE</span>,</span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">verbose =</span> <span class="cn">FALSE</span></span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb33-16"><a href="#cb33-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-17"><a href="#cb33-17" aria-hidden="true" tabindex="-1"></a><span class="co"># I want to maximize the # of localities returned  </span></span>
<span id="cb33-18"><a href="#cb33-18" aria-hidden="true" tabindex="-1"></a>maxThin <span class="ot">&lt;-</span> <span class="fu">which</span>(<span class="fu">sapply</span>(output, nrow) <span class="sc">==</span> <span class="fu">max</span>(<span class="fu">sapply</span>(output, nrow)))</span>
<span id="cb33-19"><a href="#cb33-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-20"><a href="#cb33-20" aria-hidden="true" tabindex="-1"></a><span class="co"># if there are multiple iterations with the max # of localities, pick one</span></span>
<span id="cb33-21"><a href="#cb33-21" aria-hidden="true" tabindex="-1"></a>maxThin <span class="ot">&lt;-</span></span>
<span id="cb33-22"><a href="#cb33-22" aria-hidden="true" tabindex="-1"></a>  output[[<span class="fu">ifelse</span>(<span class="fu">length</span>(maxThin) <span class="sc">&gt;</span> <span class="dv">1</span>, maxThin[<span class="dv">1</span>], maxThin)]]</span>
<span id="cb33-23"><a href="#cb33-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-24"><a href="#cb33-24" aria-hidden="true" tabindex="-1"></a><span class="co"># subset locs to match only thinned locs</span></span>
<span id="cb33-25"><a href="#cb33-25" aria-hidden="true" tabindex="-1"></a>locs_pic <span class="ot">&lt;-</span> locs_pic[<span class="fu">as.numeric</span>(<span class="fu">rownames</span>(maxThin)), ]</span>
<span id="cb33-26"><a href="#cb33-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-27"><a href="#cb33-27" aria-hidden="true" tabindex="-1"></a><span class="co"># get the unused locs as a testing data set</span></span>
<span id="cb33-28"><a href="#cb33-28" aria-hidden="true" tabindex="-1"></a><span class="co"># this probably isn't useful since they will overlap heavily with the training data, but seems like another piece of info to look at</span></span>
<span id="cb33-29"><a href="#cb33-29" aria-hidden="true" tabindex="-1"></a>test_pic <span class="ot">&lt;-</span> locs_pic[<span class="sc">-</span><span class="fu">as.numeric</span>(<span class="fu">rownames</span>(maxThin)), ]</span>
<span id="cb33-30"><a href="#cb33-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-31"><a href="#cb33-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-32"><a href="#cb33-32" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb33-33"><a href="#cb33-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> <span class="fu">st_geometry</span>(af), <span class="at">fill =</span> <span class="st">"darkgreen"</span>) <span class="sc">+</span></span>
<span id="cb33-34"><a href="#cb33-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> locs_pic)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="species_distribution_modeling_files/figure-html/spthin-pic-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Write thinned localities to file</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Write to file</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="fu">st_write</span>(locs_pic, <span class="fu">here</span>(<span class="st">"analysis"</span>, <span class="st">"output"</span>, <span class="st">"thinned_localities"</span>, <span class="st">"pictus_thinned.gpkg"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="crop-environment-1" class="level4">
<h4 class="anchored" data-anchor-id="crop-environment-1">Crop environment</h4>
<p>First, I need to read in the environmental data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>bioclims <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">rast</span>(<span class="fu">here</span>(<span class="st">"analysis"</span>, <span class="st">"output"</span>, <span class="st">"cropped_predictors"</span>, <span class="st">"bioclims.tif"</span>))</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>forest_cover <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">rast</span>(<span class="fu">here</span>(<span class="st">"analysis"</span>, <span class="st">"output"</span>, <span class="st">"cropped_predictors"</span>, <span class="st">"forest_cover.tif"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Cropping and combining variables for analysis.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>mcp_pic <span class="ot">&lt;-</span> </span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_convex_hull</span>(<span class="fu">st_union</span>(locs_pic)) <span class="sc">%&gt;%</span></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_buffer</span>(<span class="at">dist =</span> units<span class="sc">::</span><span class="fu">set_units</span>(<span class="fl">0.5</span>, degree)) <span class="sc">%&gt;%</span> </span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>  terra<span class="sc">::</span><span class="fu">vect</span>()</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>bioclims_pic <span class="ot">&lt;-</span> bioclims <span class="sc">%&gt;%</span></span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># the bioclims are in a slightly different CRS</span></span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>  terra<span class="sc">::</span><span class="fu">project</span>(forest_cover) <span class="sc">%&gt;%</span> </span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a>  terra<span class="sc">::</span><span class="fu">crop</span>(mcp_pic) <span class="sc">%&gt;%</span> </span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a>  terra<span class="sc">::</span><span class="fu">mask</span>(mcp_pic)</span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a>forest_cover_pic <span class="ot">&lt;-</span> forest_cover <span class="sc">%&gt;%</span> </span>
<span id="cb36-14"><a href="#cb36-14" aria-hidden="true" tabindex="-1"></a>  terra<span class="sc">::</span><span class="fu">crop</span>(bioclims_pic) <span class="sc">%&gt;%</span> </span>
<span id="cb36-15"><a href="#cb36-15" aria-hidden="true" tabindex="-1"></a>  terra<span class="sc">::</span><span class="fu">mask</span>(bioclims_pic[[<span class="dv">1</span>]]) </span>
<span id="cb36-16"><a href="#cb36-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-17"><a href="#cb36-17" aria-hidden="true" tabindex="-1"></a>predictors_pic <span class="ot">&lt;-</span> <span class="fu">c</span>(bioclims_pic)</span>
<span id="cb36-18"><a href="#cb36-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-19"><a href="#cb36-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-20"><a href="#cb36-20" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(bioclims_pic[[<span class="dv">1</span>]])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="species_distribution_modeling_files/figure-html/crop-env-pic-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(forest_cover_pic)</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(locs_pic, <span class="at">add =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="species_distribution_modeling_files/figure-html/crop-env-pic-2.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="predictor-correlation-1" class="level4">
<h4 class="anchored" data-anchor-id="predictor-correlation-1">Predictor correlation</h4>
<p>Sample 10000 background points. 4285 actually sampled.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">9745</span>)</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a><span class="co"># for variable correlations</span></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>bg_envt_pic <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">spatSample</span>(predictors_pic, <span class="dv">10000</span>, </span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>                               <span class="at">warn=</span><span class="cn">TRUE</span>, </span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>                               <span class="at">na.rm =</span> <span class="cn">TRUE</span>, </span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>                               <span class="at">as.df =</span> <span class="cn">TRUE</span>,</span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>                               <span class="at">xy =</span> <span class="cn">TRUE</span>)</span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a><span class="co"># for use in ENMevaluate</span></span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a>bg_coords_pic <span class="ot">&lt;-</span> bg_envt_pic[,<span class="fu">c</span>(<span class="st">"x"</span>, <span class="st">"y"</span>)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Next, I’ll extract the values for the background points and perform variance inflation factor stepwise selection with a VIF threshold of 10.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co"># extract values</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>bg_corr_pic <span class="ot">&lt;-</span> bg_envt_pic <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>x, <span class="sc">-</span>y)</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>usdm<span class="sc">::</span><span class="fu">vifstep</span>(bg_corr_pic, <span class="at">th=</span><span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>13 variables from the 19 input variables have collinearity problem: 
 
bio6 bio11 bio1 bio2 bio17 bio10 bio14 bio16 bio8 bio12 bio5 bio15 bio3 

After excluding the collinear variables, the linear correlation coefficients ranges between: 
min correlation ( bio9 ~ bio7 ):  -0.0418892 
max correlation ( bio7 ~ bio19 ):  -0.8432303 

---------- VIFs of the remained variables -------- 
  Variables      VIF
1     bio13 3.180552
2     bio18 5.561697
3     bio19 5.347767
4      bio4 2.271783
5      bio7 4.290330
6      bio9 2.505081</code></pre>
</div>
</div>
<p>The final variable list: BIO4, BIO7, BIO9, BIO13, BIO18, BIO19</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>predictors_pic <span class="ot">&lt;-</span> predictors_pic[[<span class="fu">c</span>(<span class="st">"bio4"</span>, <span class="st">"bio7"</span>, <span class="st">"bio9"</span>, <span class="st">"bio13"</span>, <span class="st">"bio18"</span>, <span class="st">"bio19"</span>)]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="maxent-model-1" class="level4">
<h4 class="anchored" data-anchor-id="maxent-model-1">Maxent model</h4>
<p>I’m using a jackknifing model evaluation approach since I only have 15 observations.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">755555598</span>)</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>coords_pic <span class="ot">&lt;-</span> <span class="fu">st_coordinates</span>(locs_pic)</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(coords_pic) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"x"</span>, <span class="st">"y"</span>)</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>folds_pic <span class="ot">&lt;-</span> ENMeval<span class="sc">::</span><span class="fu">get.jackknife</span>(<span class="at">occ =</span> coords_pic, </span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>                            <span class="at">bg =</span> bg_coords_pic)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Run the model. Predictions are clamped to prevent extrapolation. This part takes a little bit. 29 minutes 57 sec on the wall clock on a 2020 M1 MacBook air with 6 cores and 16 GB of memory. Probably because of the high number of background points and the wide range of regularization multipliers I’m exploring.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">3767557</span>)</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a><span class="co"># the vector of regularization multipliers to test</span></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>rms <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="fl">0.5</span>, <span class="dv">5</span>, <span class="fl">0.5</span>)</span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a><span class="co"># convert the terra object to a raster stack for use in EMNeval</span></span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a>predictors_pic_stack <span class="ot">&lt;-</span> raster<span class="sc">::</span><span class="fu">stack</span>(predictors_pic)</span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a><span class="co"># iterate model building over all chosen parameter settings</span></span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a>sdm_pic <span class="ot">&lt;-</span></span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a>  ENMeval<span class="sc">::</span><span class="fu">ENMevaluate</span>(</span>
<span id="cb43-12"><a href="#cb43-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">occs =</span> coords_pic,</span>
<span id="cb43-13"><a href="#cb43-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">envs =</span> predictors_pic_stack,</span>
<span id="cb43-14"><a href="#cb43-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">bg.coords =</span> bg_coords_pic,</span>
<span id="cb43-15"><a href="#cb43-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">RMvalues =</span> rms,</span>
<span id="cb43-16"><a href="#cb43-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">fc =</span> <span class="fu">c</span>(<span class="st">'L'</span>, <span class="st">'LQ'</span>),</span>
<span id="cb43-17"><a href="#cb43-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># clamping to prevent model extrapolation</span></span>
<span id="cb43-18"><a href="#cb43-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">doClamp =</span> <span class="cn">TRUE</span>,</span>
<span id="cb43-19"><a href="#cb43-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">taxon.name =</span> <span class="st">"pictus"</span>,</span>
<span id="cb43-20"><a href="#cb43-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">partitions =</span> <span class="st">"user"</span>,</span>
<span id="cb43-21"><a href="#cb43-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">user.grp =</span> folds_pic,</span>
<span id="cb43-22"><a href="#cb43-22" aria-hidden="true" tabindex="-1"></a>    bg.grp,</span>
<span id="cb43-23"><a href="#cb43-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">clamp =</span> <span class="cn">TRUE</span>,</span>
<span id="cb43-24"><a href="#cb43-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">algorithm =</span> <span class="st">"maxent.jar"</span>,</span>
<span id="cb43-25"><a href="#cb43-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">parallel =</span> <span class="cn">TRUE</span>,</span>
<span id="cb43-26"><a href="#cb43-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">numCores =</span> <span class="dv">6</span></span>
<span id="cb43-27"><a href="#cb43-27" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="co"># write the model to file</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a><span class="fu">write_rds</span>(sdm_pic, <span class="fu">here</span>(<span class="st">"analysis"</span>, <span class="st">"output"</span>, <span class="st">"sdm_models"</span>, <span class="st">"sdm_pictus.rds"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">

</div>
<section id="model-evaluation-1" class="level5">
<h5 class="anchored" data-anchor-id="model-evaluation-1">Model evaluation</h5>
<p>Let’s take a look at the model results.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>eval_table_pic <span class="ot">&lt;-</span> sdm_pic<span class="sc">@</span>results</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>eval_mods_pic <span class="ot">&lt;-</span> sdm_pic<span class="sc">@</span>models</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(eval_mods_pic) <span class="ot">&lt;-</span></span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str_replace_all</span>(<span class="fu">names</span>(eval_mods_pic), <span class="st">"</span><span class="sc">\\</span><span class="st">."</span>, <span class="st">"</span><span class="sc">\\</span><span class="st">_"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Select the final model. First I’m looking at plots of model evaluation stats to get an idea of the spread of stats.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>daic_pic <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> eval_table_pic, <span class="fu">aes</span>(<span class="at">x =</span> rm, <span class="at">y =</span> delta.AICc, <span class="at">color =</span> fc)) <span class="sc">+</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_viridis_d</span>() <span class="sc">+</span></span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>or_pic <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> eval_table_pic, <span class="fu">aes</span>(<span class="at">x =</span> rm, <span class="at">y =</span> or<span class="fl">.10</span>p.avg, <span class="at">color =</span> fc)) <span class="sc">+</span></span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_viridis_d</span>() <span class="sc">+</span></span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb46-10"><a href="#cb46-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-11"><a href="#cb46-11" aria-hidden="true" tabindex="-1"></a>dauc_pic <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> eval_table_pic, <span class="fu">aes</span>(<span class="at">x =</span> rm, <span class="at">y =</span> auc.diff.avg, <span class="at">color =</span> fc)) <span class="sc">+</span></span>
<span id="cb46-12"><a href="#cb46-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb46-13"><a href="#cb46-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_viridis_d</span>() <span class="sc">+</span></span>
<span id="cb46-14"><a href="#cb46-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb46-15"><a href="#cb46-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-16"><a href="#cb46-16" aria-hidden="true" tabindex="-1"></a>(daic_pic <span class="sc">+</span> or_pic) <span class="sc">/</span> (dauc_pic)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="species_distribution_modeling_files/figure-html/unnamed-chunk-44-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Now I’m going to take a look at tables of delta AICc, omission rate, and AUC to see how close the models are. The model with the lowest AICc has a regularization multiplier of 1 and L feature class. It also has a reasonable omission rate and AUC. I will go forward with this model.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>eval_table_pic <span class="sc">%&gt;%</span> </span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(delta.AICc, AICc, or<span class="fl">.10</span>p.avg, or.mtp.avg, auc.diff.avg, auc.val.avg, rm, fc) <span class="sc">%&gt;%</span></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(delta.AICc) <span class="sc">%&gt;%</span> </span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">10</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>  knitr<span class="sc">::</span><span class="fu">kable</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped">
<colgroup>
<col style="width: 14%">
<col style="width: 12%">
<col style="width: 14%">
<col style="width: 14%">
<col style="width: 17%">
<col style="width: 16%">
<col style="width: 5%">
<col style="width: 4%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: right;">delta.AICc</th>
<th style="text-align: right;">AICc</th>
<th style="text-align: right;">or.10p.avg</th>
<th style="text-align: right;">or.mtp.avg</th>
<th style="text-align: right;">auc.diff.avg</th>
<th style="text-align: right;">auc.val.avg</th>
<th style="text-align: left;">rm</th>
<th style="text-align: left;">fc</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">0.0000000</td>
<td style="text-align: right;">263.1299</td>
<td style="text-align: right;">0.125</td>
<td style="text-align: right;">0.0625</td>
<td style="text-align: right;">0.2796101</td>
<td style="text-align: right;">0.6794632</td>
<td style="text-align: left;">2</td>
<td style="text-align: left;">L</td>
</tr>
<tr class="even">
<td style="text-align: right;">0.3861555</td>
<td style="text-align: right;">263.5160</td>
<td style="text-align: right;">0.125</td>
<td style="text-align: right;">0.0625</td>
<td style="text-align: right;">0.2730406</td>
<td style="text-align: right;">0.6863186</td>
<td style="text-align: left;">3</td>
<td style="text-align: left;">LQ</td>
</tr>
<tr class="odd">
<td style="text-align: right;">0.5552342</td>
<td style="text-align: right;">263.6851</td>
<td style="text-align: right;">0.125</td>
<td style="text-align: right;">0.1250</td>
<td style="text-align: right;">0.2855795</td>
<td style="text-align: right;">0.6654026</td>
<td style="text-align: left;">1.5</td>
<td style="text-align: left;">L</td>
</tr>
<tr class="even">
<td style="text-align: right;">1.5570898</td>
<td style="text-align: right;">264.6870</td>
<td style="text-align: right;">0.125</td>
<td style="text-align: right;">0.0625</td>
<td style="text-align: right;">0.2828967</td>
<td style="text-align: right;">0.6761960</td>
<td style="text-align: left;">2.5</td>
<td style="text-align: left;">LQ</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1.5966498</td>
<td style="text-align: right;">264.7265</td>
<td style="text-align: right;">0.125</td>
<td style="text-align: right;">0.1250</td>
<td style="text-align: right;">0.2588020</td>
<td style="text-align: right;">0.6709452</td>
<td style="text-align: left;">1.5</td>
<td style="text-align: left;">LQ</td>
</tr>
<tr class="even">
<td style="text-align: right;">1.8085447</td>
<td style="text-align: right;">264.9384</td>
<td style="text-align: right;">0.125</td>
<td style="text-align: right;">0.1250</td>
<td style="text-align: right;">0.2526877</td>
<td style="text-align: right;">0.6614790</td>
<td style="text-align: left;">1</td>
<td style="text-align: left;">L</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2.1560991</td>
<td style="text-align: right;">265.2860</td>
<td style="text-align: right;">0.125</td>
<td style="text-align: right;">0.0625</td>
<td style="text-align: right;">0.2171840</td>
<td style="text-align: right;">0.5985123</td>
<td style="text-align: left;">3.5</td>
<td style="text-align: left;">LQ</td>
</tr>
<tr class="even">
<td style="text-align: right;">2.7018374</td>
<td style="text-align: right;">265.8317</td>
<td style="text-align: right;">0.125</td>
<td style="text-align: right;">0.0625</td>
<td style="text-align: right;">0.2171840</td>
<td style="text-align: right;">0.5985123</td>
<td style="text-align: left;">2.5</td>
<td style="text-align: left;">L</td>
</tr>
<tr class="odd">
<td style="text-align: right;">3.1709962</td>
<td style="text-align: right;">266.3009</td>
<td style="text-align: right;">0.125</td>
<td style="text-align: right;">0.0625</td>
<td style="text-align: right;">0.2795410</td>
<td style="text-align: right;">0.6686989</td>
<td style="text-align: left;">2</td>
<td style="text-align: left;">LQ</td>
</tr>
<tr class="even">
<td style="text-align: right;">3.3475819</td>
<td style="text-align: right;">266.4774</td>
<td style="text-align: right;">0.250</td>
<td style="text-align: right;">0.1250</td>
<td style="text-align: right;">0.2521567</td>
<td style="text-align: right;">0.6532526</td>
<td style="text-align: left;">1</td>
<td style="text-align: left;">LQ</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Select model.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>mod_pic <span class="ot">&lt;-</span> eval_mods_pic<span class="sc">$</span>rm_2_fc_L</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>opt_seq_tune_pic <span class="ot">&lt;-</span> eval_table_pic<span class="sc">$</span>tune.args[<span class="fu">na.omit</span>(eval_table_pic<span class="sc">$</span>delta.AICc) <span class="sc">==</span> <span class="dv">0</span>][<span class="dv">1</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Variable importance. bio7 is the only important variable</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(mod_pic)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="species_distribution_modeling_files/figure-html/var-importance-pic-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="fu">png</span>(<span class="st">"variable_contribution_pictus.png"</span>)</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(mod_pic)</span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>()</span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a><span class="fu">file.copy</span>(<span class="fu">here</span>(<span class="st">"variable_contribution_pictus.png"</span>), <span class="fu">here</span>(<span class="st">"analysis"</span>, <span class="st">"output"</span>, <span class="st">"sdm_response_curves_variable_importance"</span>, <span class="st">"variable_contribution_pictus.png"</span>))</span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a><span class="fu">file.remove</span>(<span class="fu">here</span>(<span class="st">"variable_contribution_pictus.png"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Plot the response curves. Annual range in air temperature is negatively related with presence.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>dismo<span class="sc">::</span><span class="fu">response</span>(mod_pic)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="species_distribution_modeling_files/figure-html/resp-curves-pic-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="fu">png</span>(<span class="st">"response_curves_pictus.png"</span>)</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>dismo<span class="sc">::</span><span class="fu">response</span>(mod_pic)</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>()</span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a><span class="fu">file.copy</span>(<span class="fu">here</span>(<span class="st">"response_curves_pictus.png"</span>), <span class="fu">here</span>(<span class="st">"analysis"</span>, <span class="st">"output"</span>, <span class="st">"sdm_response_curves_variable_importance"</span>, <span class="st">"response_curves_pictus.png"</span>))</span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a><span class="fu">file.remove</span>(<span class="fu">here</span>(<span class="st">"response_curves_pictus.png"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="project-1" class="level5">
<h5 class="anchored" data-anchor-id="project-1">Project</h5>
<p>I’m projecting the model to the study area extent.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>pred_pic <span class="ot">&lt;-</span> ENMeval<span class="sc">::</span><span class="fu">eval.predictions</span>(sdm_pic)[[opt_seq_tune_pic]]</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(pred_pic)</span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(af), <span class="at">add =</span> <span class="cn">TRUE</span>)</span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(locs_pic), <span class="at">pch =</span> <span class="dv">21</span>, <span class="at">bg =</span> <span class="fu">alpha</span>(<span class="st">"lightgray"</span>, <span class="fl">0.5</span>), <span class="at">add =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="species_distribution_modeling_files/figure-html/unnamed-chunk-51-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>pred_pic_thresh <span class="ot">&lt;-</span> pred_pic<span class="sc">$</span>rm<span class="fl">.2</span>_fc.L</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a><span class="co"># observed suitabilities</span></span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>obs_suit_pic <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">extract</span>(pred_pic<span class="sc">$</span>rm<span class="fl">.2</span>_fc.L, locs_pic)</span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a><span class="co"># minimum training presence</span></span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a>min_suit_pic <span class="ot">&lt;-</span> <span class="fu">min</span>(obs_suit_pic)</span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a>pred_pic_thresh[pred_pic_thresh <span class="sc">&gt;=</span> min_suit_pic] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb54-8"><a href="#cb54-8" aria-hidden="true" tabindex="-1"></a>pred_pic_thresh[pred_pic_thresh <span class="sc">&lt;</span> min_suit_pic] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb54-9"><a href="#cb54-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-10"><a href="#cb54-10" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(pred_pic_thresh)</span>
<span id="cb54-11"><a href="#cb54-11" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(af), <span class="at">add =</span> <span class="cn">TRUE</span>)</span>
<span id="cb54-12"><a href="#cb54-12" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(locs_pic), <span class="at">pch =</span> <span class="dv">21</span>, <span class="at">bg =</span> <span class="fu">alpha</span>(<span class="st">"lightgray"</span>, <span class="fl">0.5</span>), <span class="at">add =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="species_distribution_modeling_files/figure-html/proj-cur-pic-thresh-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
</section>
<section id="e.-perditus" class="level3">
<h3 class="anchored" data-anchor-id="e.-perditus">E. perditus</h3>
<p>Note: putative “perditus 2” species localities from Mariana’s phylogenetics work have been removed</p>
<p>Reading in data for plotting.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="co"># atlantic forest shapefile</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>af <span class="ot">&lt;-</span> <span class="fu">read_sf</span>(<span class="fu">here</span>(<span class="st">"analysis"</span>, <span class="st">"data"</span>, <span class="st">"atlantic_forest"</span>, <span class="st">"atlantic_forest.geojson"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="spatial-thin-2" class="level4">
<h4 class="anchored" data-anchor-id="spatial-thin-2">Spatial thin</h4>
<p>Read and filter localities.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>locs_per <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="fu">here</span>(<span class="st">"analysis"</span>, <span class="st">"data"</span>, <span class="st">"enyalius_locs.csv"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># the variable names are messy</span></span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>  janitor<span class="sc">::</span><span class="fu">clean_names</span>() <span class="sc">%&gt;%</span></span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(species <span class="sc">==</span> <span class="st">"perditus"</span>,</span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>    <span class="sc">!</span><span class="fu">is.na</span>(latitude), <span class="sc">!</span><span class="fu">is.na</span>(longitude),</span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># remove duplicates</span></span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a>    <span class="sc">!</span><span class="fu">duplicated</span>(latitude)) <span class="sc">%&gt;%</span></span>
<span id="cb56-8"><a href="#cb56-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># there are some lat/longs with spaces. Need to fix this</span></span>
<span id="cb56-9"><a href="#cb56-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">longitude =</span> <span class="fu">str_remove</span>(longitude, <span class="st">"</span><span class="sc">\\</span><span class="st">s"</span>), </span>
<span id="cb56-10"><a href="#cb56-10" aria-hidden="true" tabindex="-1"></a>         <span class="at">latitude =</span> <span class="fu">str_remove</span>(latitude, <span class="st">"</span><span class="sc">\\</span><span class="st">s"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb56-11"><a href="#cb56-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># convert to numeric</span></span>
<span id="cb56-12"><a href="#cb56-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">longitude =</span> <span class="fu">as.numeric</span>(longitude),</span>
<span id="cb56-13"><a href="#cb56-13" aria-hidden="true" tabindex="-1"></a>         <span class="at">latitude =</span> <span class="fu">as.numeric</span>(latitude)) <span class="sc">%&gt;%</span> </span>
<span id="cb56-14"><a href="#cb56-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># convert to sf for spatial operations</span></span>
<span id="cb56-15"><a href="#cb56-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_as_sf</span>(<span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"longitude"</span>, <span class="st">"latitude"</span>),</span>
<span id="cb56-16"><a href="#cb56-16" aria-hidden="true" tabindex="-1"></a>           <span class="at">crs =</span> <span class="dv">4326</span>,</span>
<span id="cb56-17"><a href="#cb56-17" aria-hidden="true" tabindex="-1"></a>           <span class="at">remove =</span> <span class="cn">FALSE</span>)</span>
<span id="cb56-18"><a href="#cb56-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-19"><a href="#cb56-19" aria-hidden="true" tabindex="-1"></a><span class="co"># plot localities</span></span>
<span id="cb56-20"><a href="#cb56-20" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(af))</span>
<span id="cb56-21"><a href="#cb56-21" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(locs_per), <span class="at">add =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="species_distribution_modeling_files/figure-html/unnamed-chunk-54-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Spatial thin. I’m using a 20 km buffer. Leaves us with 21 localities.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">117553</span>)</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a><span class="co">#run spthin algorithm. This returns 100 possible combinations of removed localities</span></span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>output <span class="ot">&lt;-</span></span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>  spThin<span class="sc">::</span><span class="fu">thin</span>(</span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a>    locs_per,</span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">'latitude'</span>,</span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">'longitude'</span>,</span>
<span id="cb57-9"><a href="#cb57-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">'species'</span>,</span>
<span id="cb57-10"><a href="#cb57-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">thin.par =</span> <span class="dv">20</span>,</span>
<span id="cb57-11"><a href="#cb57-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">reps =</span> <span class="dv">100</span>,</span>
<span id="cb57-12"><a href="#cb57-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">locs.thinned.list.return =</span> <span class="cn">TRUE</span>,</span>
<span id="cb57-13"><a href="#cb57-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">write.files =</span> <span class="cn">FALSE</span>,</span>
<span id="cb57-14"><a href="#cb57-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">verbose =</span> <span class="cn">FALSE</span></span>
<span id="cb57-15"><a href="#cb57-15" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb57-16"><a href="#cb57-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-17"><a href="#cb57-17" aria-hidden="true" tabindex="-1"></a><span class="co"># I want to maximize the # of localities returned  </span></span>
<span id="cb57-18"><a href="#cb57-18" aria-hidden="true" tabindex="-1"></a>maxThin <span class="ot">&lt;-</span> <span class="fu">which</span>(<span class="fu">sapply</span>(output, nrow) <span class="sc">==</span> <span class="fu">max</span>(<span class="fu">sapply</span>(output, nrow)))</span>
<span id="cb57-19"><a href="#cb57-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-20"><a href="#cb57-20" aria-hidden="true" tabindex="-1"></a><span class="co"># if there are multiple iterations with the max # of localities, pick one</span></span>
<span id="cb57-21"><a href="#cb57-21" aria-hidden="true" tabindex="-1"></a>maxThin <span class="ot">&lt;-</span></span>
<span id="cb57-22"><a href="#cb57-22" aria-hidden="true" tabindex="-1"></a>  output[[<span class="fu">ifelse</span>(<span class="fu">length</span>(maxThin) <span class="sc">&gt;</span> <span class="dv">1</span>, maxThin[<span class="dv">1</span>], maxThin)]]</span>
<span id="cb57-23"><a href="#cb57-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-24"><a href="#cb57-24" aria-hidden="true" tabindex="-1"></a><span class="co"># subset locs to match only thinned locs</span></span>
<span id="cb57-25"><a href="#cb57-25" aria-hidden="true" tabindex="-1"></a>locs_per <span class="ot">&lt;-</span> locs_per[<span class="fu">as.numeric</span>(<span class="fu">rownames</span>(maxThin)), ]</span>
<span id="cb57-26"><a href="#cb57-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-27"><a href="#cb57-27" aria-hidden="true" tabindex="-1"></a><span class="co"># get the unused locs as a testing data set</span></span>
<span id="cb57-28"><a href="#cb57-28" aria-hidden="true" tabindex="-1"></a><span class="co"># this probably isn't useful since they will overlap heavily with the training data, but seems like another piece of info to look at</span></span>
<span id="cb57-29"><a href="#cb57-29" aria-hidden="true" tabindex="-1"></a>test_per <span class="ot">&lt;-</span> locs_per[<span class="sc">-</span><span class="fu">as.numeric</span>(<span class="fu">rownames</span>(maxThin)), ]</span>
<span id="cb57-30"><a href="#cb57-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-31"><a href="#cb57-31" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(af))</span>
<span id="cb57-32"><a href="#cb57-32" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(locs_per), <span class="at">add=</span><span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="species_distribution_modeling_files/figure-html/unnamed-chunk-55-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Write thinned localities to file</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Write to file</span></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a><span class="fu">st_write</span>(locs_per, <span class="fu">here</span>(<span class="st">"analysis"</span>, <span class="st">"output"</span>, <span class="st">"thinned_localities"</span>, <span class="st">"perditus_thinned.gpkg"</span>),</span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">delete_dsn =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="crop-environment-2" class="level4">
<h4 class="anchored" data-anchor-id="crop-environment-2">Crop environment</h4>
<p>First, I need to read in the environmental data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>bioclims <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">rast</span>(<span class="fu">here</span>(<span class="st">"analysis"</span>, <span class="st">"output"</span>, <span class="st">"cropped_predictors"</span>, <span class="st">"bioclims.tif"</span>))</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>forest_cover <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">rast</span>(<span class="fu">here</span>(<span class="st">"analysis"</span>, <span class="st">"output"</span>, <span class="st">"cropped_predictors"</span>, <span class="st">"forest_cover.tif"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Cropping and combining variables for analysis.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>mcp_per <span class="ot">&lt;-</span> <span class="fu">st_convex_hull</span>(<span class="fu">st_union</span>(locs_per)) <span class="sc">%&gt;%</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_buffer</span>(<span class="at">dist =</span> units<span class="sc">::</span><span class="fu">set_units</span>(<span class="fl">0.5</span>, degree)) <span class="sc">%&gt;%</span> </span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>  terra<span class="sc">::</span><span class="fu">vect</span>()</span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a>bioclims_per <span class="ot">&lt;-</span> bioclims <span class="sc">%&gt;%</span></span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># the bioclims are in a slightly different CRS</span></span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a>  terra<span class="sc">::</span><span class="fu">project</span>(forest_cover) <span class="sc">%&gt;%</span> </span>
<span id="cb60-8"><a href="#cb60-8" aria-hidden="true" tabindex="-1"></a>  terra<span class="sc">::</span><span class="fu">crop</span>(mcp_per) <span class="sc">%&gt;%</span> </span>
<span id="cb60-9"><a href="#cb60-9" aria-hidden="true" tabindex="-1"></a>  terra<span class="sc">::</span><span class="fu">mask</span>(mcp_per)</span>
<span id="cb60-10"><a href="#cb60-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-11"><a href="#cb60-11" aria-hidden="true" tabindex="-1"></a>forest_cover_per <span class="ot">&lt;-</span> forest_cover <span class="sc">%&gt;%</span> </span>
<span id="cb60-12"><a href="#cb60-12" aria-hidden="true" tabindex="-1"></a>  terra<span class="sc">::</span><span class="fu">crop</span>(mcp_per) <span class="sc">%&gt;%</span> </span>
<span id="cb60-13"><a href="#cb60-13" aria-hidden="true" tabindex="-1"></a>  terra<span class="sc">::</span><span class="fu">mask</span>(mcp_per) </span>
<span id="cb60-14"><a href="#cb60-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-15"><a href="#cb60-15" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(bioclims_per[[<span class="dv">1</span>]])</span>
<span id="cb60-16"><a href="#cb60-16" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(locs_per), <span class="at">add =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="species_distribution_modeling_files/figure-html/unnamed-chunk-58-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(forest_cover_per)</span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(locs_per), <span class="at">add =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="species_distribution_modeling_files/figure-html/unnamed-chunk-58-2.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>predictors_per <span class="ot">&lt;-</span> <span class="fu">c</span>(bioclims_per)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="predictor-correlation-2" class="level4">
<h4 class="anchored" data-anchor-id="predictor-correlation-2">Predictor correlation</h4>
<p>Sample 10000 background points. Actually got 4225 points.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">86999784</span>)</span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a><span class="co"># for variable correlations</span></span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a>bg_envt_per <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">spatSample</span>(predictors_per, <span class="dv">10000</span>, </span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a>                               <span class="at">warn=</span><span class="cn">TRUE</span>, </span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a>                               <span class="at">na.rm =</span> <span class="cn">TRUE</span>, </span>
<span id="cb63-7"><a href="#cb63-7" aria-hidden="true" tabindex="-1"></a>                               <span class="at">as.df =</span> <span class="cn">TRUE</span>,</span>
<span id="cb63-8"><a href="#cb63-8" aria-hidden="true" tabindex="-1"></a>                               <span class="at">xy =</span> <span class="cn">TRUE</span>)</span>
<span id="cb63-9"><a href="#cb63-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-10"><a href="#cb63-10" aria-hidden="true" tabindex="-1"></a><span class="co"># for use in ENMevaluate</span></span>
<span id="cb63-11"><a href="#cb63-11" aria-hidden="true" tabindex="-1"></a>bg_coords_per <span class="ot">&lt;-</span> bg_envt_per[,<span class="fu">c</span>(<span class="st">"x"</span>, <span class="st">"y"</span>)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Next, I’ll extract the values for the background points and perform variance inflation factor stepwise selection with a VIF threshold of 10.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="co"># extract values</span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>bg_corr_per <span class="ot">&lt;-</span> bg_envt_per <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>x, <span class="sc">-</span>y)</span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a>usdm<span class="sc">::</span><span class="fu">vifstep</span>(bg_corr_per, <span class="at">th=</span><span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>13 variables from the 19 input variables have collinearity problem: 
 
bio6 bio9 bio11 bio10 bio16 bio1 bio2 bio17 bio15 bio12 bio14 bio5 bio4 

After excluding the collinear variables, the linear correlation coefficients ranges between: 
min correlation ( bio8 ~ bio7 ):  0.008159235 
max correlation ( bio18 ~ bio13 ):  0.7985442 

---------- VIFs of the remained variables -------- 
  Variables      VIF
1     bio13 5.975932
2     bio18 5.104742
3     bio19 2.053604
4      bio3 1.825184
5      bio7 1.688345
6      bio8 1.454240</code></pre>
</div>
</div>
<p>The final variable list: BIO3, BIO7, BIO8, BIO13, BIO18, BIO19</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>predictors_per <span class="ot">&lt;-</span> predictors_per[[<span class="fu">c</span>(<span class="st">"bio3"</span>, <span class="st">"bio7"</span>, <span class="st">"bio8"</span>, <span class="st">"bio13"</span>, <span class="st">"bio18"</span>,  <span class="st">"bio19"</span>)]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="maxent-model-2" class="level4">
<h4 class="anchored" data-anchor-id="maxent-model-2">Maxent model</h4>
<p>I’m using a jackknife model evaluation approach since I only have 17 observations.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">42344377</span>)</span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>coords_per <span class="ot">&lt;-</span> <span class="fu">st_coordinates</span>(locs_per)</span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(coords_per) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"x"</span>, <span class="st">"y"</span>)</span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a>folds_per <span class="ot">&lt;-</span> ENMeval<span class="sc">::</span><span class="fu">get.jackknife</span>(<span class="at">occ =</span> coords_per, </span>
<span id="cb67-6"><a href="#cb67-6" aria-hidden="true" tabindex="-1"></a>                            <span class="at">bg =</span> bg_coords_per)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Run the model. Predictions are clamped to prevent extrapolation.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">9769997</span>)</span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a><span class="co"># the vector of regularization multipliers to test</span></span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a>rms <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="fl">0.5</span>, <span class="dv">5</span>, <span class="fl">0.5</span>)</span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-6"><a href="#cb68-6" aria-hidden="true" tabindex="-1"></a><span class="co"># convert the terra object to a raster stack for use in EMNeval</span></span>
<span id="cb68-7"><a href="#cb68-7" aria-hidden="true" tabindex="-1"></a>predictors_per_stack <span class="ot">&lt;-</span> raster<span class="sc">::</span><span class="fu">stack</span>(predictors_per)</span>
<span id="cb68-8"><a href="#cb68-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-9"><a href="#cb68-9" aria-hidden="true" tabindex="-1"></a><span class="co"># iterate model building over all chosen parameter settings</span></span>
<span id="cb68-10"><a href="#cb68-10" aria-hidden="true" tabindex="-1"></a>sdm_per <span class="ot">&lt;-</span></span>
<span id="cb68-11"><a href="#cb68-11" aria-hidden="true" tabindex="-1"></a>  ENMeval<span class="sc">::</span><span class="fu">ENMevaluate</span>(</span>
<span id="cb68-12"><a href="#cb68-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">occs =</span> coords_per,</span>
<span id="cb68-13"><a href="#cb68-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">envs =</span> predictors_per_stack,</span>
<span id="cb68-14"><a href="#cb68-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">bg.coords =</span> bg_coords_per,</span>
<span id="cb68-15"><a href="#cb68-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">RMvalues =</span> rms,</span>
<span id="cb68-16"><a href="#cb68-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">fc =</span> <span class="fu">c</span>(<span class="st">'L'</span>, <span class="st">'LQ'</span>),</span>
<span id="cb68-17"><a href="#cb68-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># clamping to prevent model extrapolation</span></span>
<span id="cb68-18"><a href="#cb68-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">doClamp =</span> <span class="cn">TRUE</span>,</span>
<span id="cb68-19"><a href="#cb68-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">taxon.name =</span> <span class="st">"perditus"</span>,</span>
<span id="cb68-20"><a href="#cb68-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">partitions =</span> <span class="st">"user"</span>,</span>
<span id="cb68-21"><a href="#cb68-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># going to do a separate run with the final model on testing data</span></span>
<span id="cb68-22"><a href="#cb68-22" aria-hidden="true" tabindex="-1"></a>    <span class="co">#occs.testing = test_per,</span></span>
<span id="cb68-23"><a href="#cb68-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">user.grp =</span> folds_per,</span>
<span id="cb68-24"><a href="#cb68-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">clamp =</span> <span class="cn">TRUE</span>,</span>
<span id="cb68-25"><a href="#cb68-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">algorithm =</span> <span class="st">"maxent.jar"</span>,</span>
<span id="cb68-26"><a href="#cb68-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">parallel =</span> <span class="cn">TRUE</span>,</span>
<span id="cb68-27"><a href="#cb68-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">numCores =</span> <span class="dv">6</span></span>
<span id="cb68-28"><a href="#cb68-28" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="co"># write the model to file</span></span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a><span class="fu">write_rds</span>(sdm_per, <span class="fu">here</span>(<span class="st">"analysis"</span>, <span class="st">"output"</span>, <span class="st">"sdm_models"</span>, <span class="st">"sdm_perditus.rds"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">

</div>
<section id="model-evaluation-2" class="level5">
<h5 class="anchored" data-anchor-id="model-evaluation-2">Model evaluation</h5>
<p>Let’s take a look at the model results.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>eval_table_per <span class="ot">&lt;-</span> sdm_per<span class="sc">@</span>results</span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>eval_mods_per <span class="ot">&lt;-</span> sdm_per<span class="sc">@</span>models</span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(eval_mods_per) <span class="ot">&lt;-</span></span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str_replace_all</span>(<span class="fu">names</span>(eval_mods_per), <span class="st">"</span><span class="sc">\\</span><span class="st">."</span>, <span class="st">"</span><span class="sc">\\</span><span class="st">_"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Select the final model. First I’m looking at plots of model evaluation stats to get an idea of the spread of stats.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>daic_per <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> eval_table_per, <span class="fu">aes</span>(<span class="at">x =</span> rm, <span class="at">y =</span> delta.AICc, <span class="at">color =</span> fc)) <span class="sc">+</span></span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_viridis_d</span>() <span class="sc">+</span></span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-6"><a href="#cb71-6" aria-hidden="true" tabindex="-1"></a>or_per <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> eval_table_per, <span class="fu">aes</span>(<span class="at">x =</span> rm, <span class="at">y =</span> or<span class="fl">.10</span>p.avg, <span class="at">color =</span> fc)) <span class="sc">+</span></span>
<span id="cb71-7"><a href="#cb71-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb71-8"><a href="#cb71-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_viridis_d</span>() <span class="sc">+</span></span>
<span id="cb71-9"><a href="#cb71-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb71-10"><a href="#cb71-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-11"><a href="#cb71-11" aria-hidden="true" tabindex="-1"></a>dauc_per <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> eval_table_per, <span class="fu">aes</span>(<span class="at">x =</span> rm, <span class="at">y =</span> auc.diff.avg, <span class="at">color =</span> fc)) <span class="sc">+</span></span>
<span id="cb71-12"><a href="#cb71-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb71-13"><a href="#cb71-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_viridis_d</span>() <span class="sc">+</span></span>
<span id="cb71-14"><a href="#cb71-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb71-15"><a href="#cb71-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-16"><a href="#cb71-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-17"><a href="#cb71-17" aria-hidden="true" tabindex="-1"></a>(daic_per <span class="sc">+</span> or_per) <span class="sc">/</span> (dauc_per)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="species_distribution_modeling_files/figure-html/unnamed-chunk-67-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Now I’m going to take a look at tables of delta AICc, omission rate, and AUC to see how close the models are. The model with the lowest AICc has a relatively high omission error rate (0.24), so I chose the model with a lower OR (0.12) that is only 1.15 AICc away (fc LQ and rm 3.5). It is also a simpler model with a 3.5 regularization multiplier, which is nice.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>eval_table_per <span class="sc">%&gt;%</span> </span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(delta.AICc, AICc, or<span class="fl">.10</span>p.avg, or.mtp.avg, auc.diff.avg, auc.val.avg, rm, fc) <span class="sc">%&gt;%</span></span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(delta.AICc) <span class="sc">%&gt;%</span> </span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">10</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a>  knitr<span class="sc">::</span><span class="fu">kable</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped">
<colgroup>
<col style="width: 14%">
<col style="width: 12%">
<col style="width: 14%">
<col style="width: 14%">
<col style="width: 17%">
<col style="width: 16%">
<col style="width: 5%">
<col style="width: 4%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: right;">delta.AICc</th>
<th style="text-align: right;">AICc</th>
<th style="text-align: right;">or.10p.avg</th>
<th style="text-align: right;">or.mtp.avg</th>
<th style="text-align: right;">auc.diff.avg</th>
<th style="text-align: right;">auc.val.avg</th>
<th style="text-align: left;">rm</th>
<th style="text-align: left;">fc</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">0.0000000</td>
<td style="text-align: right;">339.5757</td>
<td style="text-align: right;">0.1428571</td>
<td style="text-align: right;">0.047619</td>
<td style="text-align: right;">0.1784993</td>
<td style="text-align: right;">0.7334968</td>
<td style="text-align: left;">2</td>
<td style="text-align: left;">LQ</td>
</tr>
<tr class="even">
<td style="text-align: right;">0.4158697</td>
<td style="text-align: right;">339.9916</td>
<td style="text-align: right;">0.1428571</td>
<td style="text-align: right;">0.047619</td>
<td style="text-align: right;">0.1789456</td>
<td style="text-align: right;">0.7397182</td>
<td style="text-align: left;">2.5</td>
<td style="text-align: left;">LQ</td>
</tr>
<tr class="odd">
<td style="text-align: right;">0.9368890</td>
<td style="text-align: right;">340.5126</td>
<td style="text-align: right;">0.1428571</td>
<td style="text-align: right;">0.047619</td>
<td style="text-align: right;">0.1748540</td>
<td style="text-align: right;">0.7432122</td>
<td style="text-align: left;">3</td>
<td style="text-align: left;">LQ</td>
</tr>
<tr class="even">
<td style="text-align: right;">1.5436325</td>
<td style="text-align: right;">341.1193</td>
<td style="text-align: right;">0.1428571</td>
<td style="text-align: right;">0.047619</td>
<td style="text-align: right;">0.1738036</td>
<td style="text-align: right;">0.7433587</td>
<td style="text-align: left;">3.5</td>
<td style="text-align: left;">LQ</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1.9497229</td>
<td style="text-align: right;">341.5254</td>
<td style="text-align: right;">0.1428571</td>
<td style="text-align: right;">0.047619</td>
<td style="text-align: right;">0.1782947</td>
<td style="text-align: right;">0.7395717</td>
<td style="text-align: left;">2</td>
<td style="text-align: left;">L</td>
</tr>
<tr class="even">
<td style="text-align: right;">2.2600904</td>
<td style="text-align: right;">341.8358</td>
<td style="text-align: right;">0.1428571</td>
<td style="text-align: right;">0.047619</td>
<td style="text-align: right;">0.1734979</td>
<td style="text-align: right;">0.7428064</td>
<td style="text-align: left;">4</td>
<td style="text-align: left;">LQ</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2.3218255</td>
<td style="text-align: right;">341.8975</td>
<td style="text-align: right;">0.1904762</td>
<td style="text-align: right;">0.047619</td>
<td style="text-align: right;">0.1875503</td>
<td style="text-align: right;">0.7163539</td>
<td style="text-align: left;">1.5</td>
<td style="text-align: left;">LQ</td>
</tr>
<tr class="even">
<td style="text-align: right;">2.6385383</td>
<td style="text-align: right;">342.2143</td>
<td style="text-align: right;">0.1428571</td>
<td style="text-align: right;">0.047619</td>
<td style="text-align: right;">0.1786994</td>
<td style="text-align: right;">0.7393914</td>
<td style="text-align: left;">2.5</td>
<td style="text-align: left;">L</td>
</tr>
<tr class="odd">
<td style="text-align: right;">3.0814332</td>
<td style="text-align: right;">342.6571</td>
<td style="text-align: right;">0.1428571</td>
<td style="text-align: right;">0.047619</td>
<td style="text-align: right;">0.1733570</td>
<td style="text-align: right;">0.7413863</td>
<td style="text-align: left;">4.5</td>
<td style="text-align: left;">LQ</td>
</tr>
<tr class="even">
<td style="text-align: right;">3.5107314</td>
<td style="text-align: right;">343.0864</td>
<td style="text-align: right;">0.1428571</td>
<td style="text-align: right;">0.047619</td>
<td style="text-align: right;">0.1691615</td>
<td style="text-align: right;">0.7275796</td>
<td style="text-align: left;">1</td>
<td style="text-align: left;">L</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Select model.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>mod_per <span class="ot">&lt;-</span> eval_mods_per<span class="sc">$</span>rm_2_fc_LQ</span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>opt_seq_tune_per <span class="ot">&lt;-</span> eval_table_per<span class="sc">$</span>tune.args[eval_table_per<span class="sc">$</span>tune.args <span class="sc">==</span> <span class="st">"rm.2_fc.LQ"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Variable importance. BIO8 and BIO3.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(mod_per)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="species_distribution_modeling_files/figure-html/var-imp-perditus-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="fu">png</span>(<span class="st">"variable_contribution_perditus.png"</span>)</span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(mod_per)</span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>()</span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a><span class="fu">file.copy</span>(<span class="fu">here</span>(<span class="st">"variable_contribution_perditus.png"</span>), <span class="fu">here</span>(<span class="st">"analysis"</span>, <span class="st">"output"</span>, <span class="st">"sdm_response_curves_variable_importance"</span>, <span class="st">"variable_contribution_perditus.png"</span>))</span>
<span id="cb75-6"><a href="#cb75-6" aria-hidden="true" tabindex="-1"></a><span class="fu">file.remove</span>(<span class="fu">here</span>(<span class="st">"variable_contribution_perditus.png"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Plot the response curves. Almost binary response with isothermality, higher = lower suitability. Lower mean daily temps of the wettest quarter correspond with higher suitability.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>dismo<span class="sc">::</span><span class="fu">response</span>(mod_per)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="species_distribution_modeling_files/figure-html/resp-curves-per-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="fu">png</span>(<span class="st">"response_curves_perditus.png"</span>)</span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>dismo<span class="sc">::</span><span class="fu">response</span>(mod_per)</span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>()</span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-5"><a href="#cb77-5" aria-hidden="true" tabindex="-1"></a><span class="fu">file.copy</span>(<span class="fu">here</span>(<span class="st">"response_curves_perditus.png"</span>), <span class="fu">here</span>(<span class="st">"analysis"</span>, <span class="st">"output"</span>, <span class="st">"sdm_response_curves_variable_importance"</span>, <span class="st">"response_curves_perditus.png"</span>))</span>
<span id="cb77-6"><a href="#cb77-6" aria-hidden="true" tabindex="-1"></a><span class="fu">file.remove</span>(<span class="fu">here</span>(<span class="st">"response_curves_perditus.png"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="project-2" class="level5">
<h5 class="anchored" data-anchor-id="project-2">Project</h5>
<p>I’m projecting the model to the study area extent.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>pred_per <span class="ot">&lt;-</span> ENMeval<span class="sc">::</span><span class="fu">eval.predictions</span>(sdm_per)[[opt_seq_tune_per]]</span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(pred_per)</span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(af), <span class="at">add =</span> <span class="cn">TRUE</span>)</span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(locs_per), <span class="at">pch =</span> <span class="dv">21</span>, <span class="at">bg =</span> <span class="fu">alpha</span>(<span class="st">"lightgray"</span>, <span class="fl">0.5</span>), <span class="at">add =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="species_distribution_modeling_files/figure-html/unnamed-chunk-74-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>pred_per_thresh <span class="ot">&lt;-</span> pred_per<span class="sc">$</span>rm<span class="fl">.2</span>_fc.LQ</span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a><span class="co"># observed suitabilities</span></span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a>obs_suit_per <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">extract</span>(pred_per<span class="sc">$</span>rm<span class="fl">.2</span>_fc.LQ, locs_per)</span>
<span id="cb79-4"><a href="#cb79-4" aria-hidden="true" tabindex="-1"></a><span class="co"># minimum training presence</span></span>
<span id="cb79-5"><a href="#cb79-5" aria-hidden="true" tabindex="-1"></a>min_suit_per <span class="ot">&lt;-</span> <span class="fu">min</span>(obs_suit_per)</span>
<span id="cb79-6"><a href="#cb79-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-7"><a href="#cb79-7" aria-hidden="true" tabindex="-1"></a>pred_per_thresh[pred_per_thresh <span class="sc">&gt;=</span> min_suit_per] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb79-8"><a href="#cb79-8" aria-hidden="true" tabindex="-1"></a>pred_per_thresh[pred_per_thresh <span class="sc">&lt;</span> min_suit_per] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb79-9"><a href="#cb79-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-10"><a href="#cb79-10" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(pred_per_thresh)</span>
<span id="cb79-11"><a href="#cb79-11" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(af), <span class="at">add =</span> <span class="cn">TRUE</span>)</span>
<span id="cb79-12"><a href="#cb79-12" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(locs_per), <span class="at">pch =</span> <span class="dv">21</span>, <span class="at">bg =</span> <span class="fu">alpha</span>(<span class="st">"lightgray"</span>, <span class="fl">0.5</span>), <span class="at">add =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="species_distribution_modeling_files/figure-html/proj-cur-per-thresh-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
</section>
<section id="e.-iheringii" class="level3">
<h3 class="anchored" data-anchor-id="e.-iheringii">E. iheringii</h3>
<p>Reading in data for plotting.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="co"># atlantic forest shapefile</span></span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a>af <span class="ot">&lt;-</span> <span class="fu">read_sf</span>(<span class="fu">here</span>(<span class="st">"analysis"</span>, <span class="st">"data"</span>, <span class="st">"atlantic_forest"</span>, <span class="st">"atlantic_forest.geojson"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="spatial-thin-3" class="level4">
<h4 class="anchored" data-anchor-id="spatial-thin-3">Spatial thin</h4>
<p>Read and filter localities.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>locs_ihe <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="fu">here</span>(<span class="st">"analysis"</span>, <span class="st">"data"</span>, <span class="st">"enyalius_locs.csv"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># the variable names are messy</span></span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a>  janitor<span class="sc">::</span><span class="fu">clean_names</span>() <span class="sc">%&gt;%</span></span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(species <span class="sc">==</span> <span class="st">"iheringii"</span>,</span>
<span id="cb81-5"><a href="#cb81-5" aria-hidden="true" tabindex="-1"></a>    <span class="sc">!</span><span class="fu">is.na</span>(latitude), <span class="sc">!</span><span class="fu">is.na</span>(longitude),</span>
<span id="cb81-6"><a href="#cb81-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># remove duplicates</span></span>
<span id="cb81-7"><a href="#cb81-7" aria-hidden="true" tabindex="-1"></a>    <span class="sc">!</span><span class="fu">duplicated</span>(latitude)</span>
<span id="cb81-8"><a href="#cb81-8" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb81-9"><a href="#cb81-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># there are some lat/longs with spaces. Need to fix this</span></span>
<span id="cb81-10"><a href="#cb81-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">longitude =</span> <span class="fu">str_remove</span>(longitude, <span class="st">"</span><span class="sc">\\</span><span class="st">s"</span>), </span>
<span id="cb81-11"><a href="#cb81-11" aria-hidden="true" tabindex="-1"></a>         <span class="at">latitude =</span> <span class="fu">str_remove</span>(latitude, <span class="st">"</span><span class="sc">\\</span><span class="st">s"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb81-12"><a href="#cb81-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># convert to numeric</span></span>
<span id="cb81-13"><a href="#cb81-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">longitude =</span> <span class="fu">as.numeric</span>(longitude),</span>
<span id="cb81-14"><a href="#cb81-14" aria-hidden="true" tabindex="-1"></a>         <span class="at">latitude =</span> <span class="fu">as.numeric</span>(latitude)) <span class="sc">%&gt;%</span> </span>
<span id="cb81-15"><a href="#cb81-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># some localities fall into the ocean when the rasters are aggregated. They need to be bumped by 0.05 degrees to overlap their respective environmental layer. Given the coarseness of the analysis, this does not bias results. </span></span>
<span id="cb81-16"><a href="#cb81-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb81-17"><a href="#cb81-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">longitude =</span> <span class="fu">case_when</span>(</span>
<span id="cb81-18"><a href="#cb81-18" aria-hidden="true" tabindex="-1"></a>      longitude <span class="sc">==</span> <span class="sc">-</span><span class="fl">47.01956</span> <span class="sc">~</span> longitude <span class="sc">-</span> <span class="fl">0.05</span>,</span>
<span id="cb81-19"><a href="#cb81-19" aria-hidden="true" tabindex="-1"></a>      longitude <span class="sc">==</span> <span class="sc">-</span><span class="fl">47.93278</span> <span class="sc">~</span> longitude <span class="sc">-</span> <span class="fl">0.05</span>,</span>
<span id="cb81-20"><a href="#cb81-20" aria-hidden="true" tabindex="-1"></a>      longitude <span class="sc">==</span> <span class="sc">-</span><span class="fl">47.93139</span> <span class="sc">~</span> longitude <span class="sc">-</span> <span class="fl">0.05</span>,</span>
<span id="cb81-21"><a href="#cb81-21" aria-hidden="true" tabindex="-1"></a>      longitude <span class="sc">==</span> <span class="sc">-</span><span class="fl">48.03889</span> <span class="sc">~</span> longitude <span class="sc">-</span> <span class="fl">0.05</span>,</span>
<span id="cb81-22"><a href="#cb81-22" aria-hidden="true" tabindex="-1"></a>      <span class="at">.default =</span> longitude</span>
<span id="cb81-23"><a href="#cb81-23" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb81-24"><a href="#cb81-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">latitude =</span> <span class="fu">case_when</span>(latitude <span class="sc">==</span> <span class="sc">-</span><span class="fl">23.595</span> <span class="sc">~</span> latitude <span class="sc">+</span> <span class="fl">0.05</span>,</span>
<span id="cb81-25"><a href="#cb81-25" aria-hidden="true" tabindex="-1"></a>                         <span class="at">.default =</span> latitude)</span>
<span id="cb81-26"><a href="#cb81-26" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb81-27"><a href="#cb81-27" aria-hidden="true" tabindex="-1"></a>  <span class="co"># convert to sf for spatial operations</span></span>
<span id="cb81-28"><a href="#cb81-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_as_sf</span>(<span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"longitude"</span>, <span class="st">"latitude"</span>),</span>
<span id="cb81-29"><a href="#cb81-29" aria-hidden="true" tabindex="-1"></a>           <span class="at">crs =</span> <span class="dv">4326</span>,</span>
<span id="cb81-30"><a href="#cb81-30" aria-hidden="true" tabindex="-1"></a>           <span class="at">remove =</span> <span class="cn">FALSE</span>)</span>
<span id="cb81-31"><a href="#cb81-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-32"><a href="#cb81-32" aria-hidden="true" tabindex="-1"></a><span class="co"># plot localities</span></span>
<span id="cb81-33"><a href="#cb81-33" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(af))</span>
<span id="cb81-34"><a href="#cb81-34" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(locs_ihe), <span class="at">add =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="species_distribution_modeling_files/figure-html/unnamed-chunk-77-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Spatial thin. I’m using a 20 km buffer</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">2333</span>)</span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a><span class="co">#run spthin algorithm. This returns 100 possible combinations of removed localities</span></span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a>output <span class="ot">&lt;-</span></span>
<span id="cb82-5"><a href="#cb82-5" aria-hidden="true" tabindex="-1"></a>  spThin<span class="sc">::</span><span class="fu">thin</span>(</span>
<span id="cb82-6"><a href="#cb82-6" aria-hidden="true" tabindex="-1"></a>    locs_ihe,</span>
<span id="cb82-7"><a href="#cb82-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">'latitude'</span>,</span>
<span id="cb82-8"><a href="#cb82-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">'longitude'</span>,</span>
<span id="cb82-9"><a href="#cb82-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">'species'</span>,</span>
<span id="cb82-10"><a href="#cb82-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">thin.par =</span> <span class="dv">20</span>,</span>
<span id="cb82-11"><a href="#cb82-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">reps =</span> <span class="dv">100</span>,</span>
<span id="cb82-12"><a href="#cb82-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">locs.thinned.list.return =</span> <span class="cn">TRUE</span>,</span>
<span id="cb82-13"><a href="#cb82-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">write.files =</span> <span class="cn">FALSE</span>,</span>
<span id="cb82-14"><a href="#cb82-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">verbose =</span> <span class="cn">FALSE</span></span>
<span id="cb82-15"><a href="#cb82-15" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb82-16"><a href="#cb82-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-17"><a href="#cb82-17" aria-hidden="true" tabindex="-1"></a><span class="co"># I want to maximize the # of localities returned  </span></span>
<span id="cb82-18"><a href="#cb82-18" aria-hidden="true" tabindex="-1"></a>maxThin <span class="ot">&lt;-</span> <span class="fu">which</span>(<span class="fu">sapply</span>(output, nrow) <span class="sc">==</span> <span class="fu">max</span>(<span class="fu">sapply</span>(output, nrow)))</span>
<span id="cb82-19"><a href="#cb82-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-20"><a href="#cb82-20" aria-hidden="true" tabindex="-1"></a><span class="co"># if there are multiple iterations with the max # of localities, pick one</span></span>
<span id="cb82-21"><a href="#cb82-21" aria-hidden="true" tabindex="-1"></a>maxThin <span class="ot">&lt;-</span></span>
<span id="cb82-22"><a href="#cb82-22" aria-hidden="true" tabindex="-1"></a>  output[[<span class="fu">ifelse</span>(<span class="fu">length</span>(maxThin) <span class="sc">&gt;</span> <span class="dv">1</span>, maxThin[<span class="dv">1</span>], maxThin)]]</span>
<span id="cb82-23"><a href="#cb82-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-24"><a href="#cb82-24" aria-hidden="true" tabindex="-1"></a><span class="co"># subset locs to match only thinned locs</span></span>
<span id="cb82-25"><a href="#cb82-25" aria-hidden="true" tabindex="-1"></a>locs_ihe <span class="ot">&lt;-</span> locs_ihe[<span class="fu">as.numeric</span>(<span class="fu">rownames</span>(maxThin)), ]</span>
<span id="cb82-26"><a href="#cb82-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-27"><a href="#cb82-27" aria-hidden="true" tabindex="-1"></a><span class="co"># get the unused locs as a testing data set</span></span>
<span id="cb82-28"><a href="#cb82-28" aria-hidden="true" tabindex="-1"></a><span class="co"># this probably isn't useful since they will overlap heavily with the training data, but seems like another piece of info to look at</span></span>
<span id="cb82-29"><a href="#cb82-29" aria-hidden="true" tabindex="-1"></a>test_ihe <span class="ot">&lt;-</span> locs_ihe[<span class="sc">-</span><span class="fu">as.numeric</span>(<span class="fu">rownames</span>(maxThin)), ]</span>
<span id="cb82-30"><a href="#cb82-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-31"><a href="#cb82-31" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(af))</span>
<span id="cb82-32"><a href="#cb82-32" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(locs_ihe), <span class="at">add=</span><span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="species_distribution_modeling_files/figure-html/unnamed-chunk-78-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Write thinned localities to file</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Write to file</span></span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a><span class="fu">st_write</span>(locs_ihe, <span class="fu">here</span>(<span class="st">"analysis"</span>, <span class="st">"output"</span>, <span class="st">"thinned_localities"</span>, <span class="st">"iheringii_thinned.gpkg"</span>),</span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">delete_dsn =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="crop-environment-3" class="level4">
<h4 class="anchored" data-anchor-id="crop-environment-3">Crop environment</h4>
<p>First, I need to read in the environmental data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a>bioclims <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">rast</span>(<span class="fu">here</span>(<span class="st">"analysis"</span>, <span class="st">"output"</span>, <span class="st">"cropped_predictors"</span>, <span class="st">"bioclims.tif"</span>))</span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a>forest_cover <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">rast</span>(<span class="fu">here</span>(<span class="st">"analysis"</span>, <span class="st">"output"</span>, <span class="st">"cropped_predictors"</span>, <span class="st">"forest_cover.tif"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Cropping and combining variables for analysis. Cropping to 0.5 degree buffer to accomodate reasonable dispersal</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a>mcp_ihe <span class="ot">&lt;-</span> <span class="fu">st_convex_hull</span>(<span class="fu">st_union</span>(locs_ihe)) <span class="sc">%&gt;%</span></span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_buffer</span>(<span class="at">dist =</span> units<span class="sc">::</span><span class="fu">set_units</span>(<span class="fl">0.5</span>, degree)) <span class="sc">%&gt;%</span> </span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a>  terra<span class="sc">::</span><span class="fu">vect</span>()</span>
<span id="cb85-4"><a href="#cb85-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-5"><a href="#cb85-5" aria-hidden="true" tabindex="-1"></a>bioclims_ihe <span class="ot">&lt;-</span> bioclims <span class="sc">%&gt;%</span></span>
<span id="cb85-6"><a href="#cb85-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># the bioclims are in a slightly different CRS</span></span>
<span id="cb85-7"><a href="#cb85-7" aria-hidden="true" tabindex="-1"></a>  terra<span class="sc">::</span><span class="fu">project</span>(forest_cover) <span class="sc">%&gt;%</span> </span>
<span id="cb85-8"><a href="#cb85-8" aria-hidden="true" tabindex="-1"></a>  terra<span class="sc">::</span><span class="fu">crop</span>(mcp_ihe) <span class="sc">%&gt;%</span> </span>
<span id="cb85-9"><a href="#cb85-9" aria-hidden="true" tabindex="-1"></a>  terra<span class="sc">::</span><span class="fu">mask</span>(mcp_ihe)</span>
<span id="cb85-10"><a href="#cb85-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-11"><a href="#cb85-11" aria-hidden="true" tabindex="-1"></a>forest_cover_ihe <span class="ot">&lt;-</span> forest_cover <span class="sc">%&gt;%</span> </span>
<span id="cb85-12"><a href="#cb85-12" aria-hidden="true" tabindex="-1"></a>  terra<span class="sc">::</span><span class="fu">crop</span>(bioclims_ihe) <span class="sc">%&gt;%</span> </span>
<span id="cb85-13"><a href="#cb85-13" aria-hidden="true" tabindex="-1"></a>  terra<span class="sc">::</span><span class="fu">mask</span>(bioclims_ihe) </span>
<span id="cb85-14"><a href="#cb85-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-15"><a href="#cb85-15" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(bioclims_ihe[[<span class="dv">1</span>]])</span>
<span id="cb85-16"><a href="#cb85-16" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(locs_ihe), <span class="at">add =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="species_distribution_modeling_files/figure-html/unnamed-chunk-81-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(forest_cover_ihe[[<span class="dv">1</span>]])</span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(locs_ihe), <span class="at">add =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="species_distribution_modeling_files/figure-html/unnamed-chunk-81-2.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a>predictors_ihe <span class="ot">&lt;-</span> <span class="fu">c</span>(bioclims_ihe)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="predictor-correlation-3" class="level4">
<h4 class="anchored" data-anchor-id="predictor-correlation-3">Predictor correlation</h4>
<p>Sample 10000 background points. Only 6515 were able to be sampled.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">7488</span>)</span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a><span class="co"># for variable correlations</span></span>
<span id="cb88-4"><a href="#cb88-4" aria-hidden="true" tabindex="-1"></a>bg_envt_ihe <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">spatSample</span>(predictors_ihe, <span class="dv">10000</span>, </span>
<span id="cb88-5"><a href="#cb88-5" aria-hidden="true" tabindex="-1"></a>                               <span class="at">warn=</span><span class="cn">TRUE</span>, </span>
<span id="cb88-6"><a href="#cb88-6" aria-hidden="true" tabindex="-1"></a>                               <span class="at">na.rm =</span> <span class="cn">TRUE</span>, </span>
<span id="cb88-7"><a href="#cb88-7" aria-hidden="true" tabindex="-1"></a>                               <span class="at">as.df =</span> <span class="cn">TRUE</span>,</span>
<span id="cb88-8"><a href="#cb88-8" aria-hidden="true" tabindex="-1"></a>                               <span class="at">xy =</span> <span class="cn">TRUE</span>)</span>
<span id="cb88-9"><a href="#cb88-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-10"><a href="#cb88-10" aria-hidden="true" tabindex="-1"></a><span class="co"># for use in ENMevaluate</span></span>
<span id="cb88-11"><a href="#cb88-11" aria-hidden="true" tabindex="-1"></a>bg_coords_ihe <span class="ot">&lt;-</span> bg_envt_ihe[,<span class="fu">c</span>(<span class="st">"x"</span>, <span class="st">"y"</span>)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Next, I’ll extract the values for the background points and perform variance inflation factor stepwise selection with a VIF threshold of 10.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="co"># extract values</span></span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a>bg_corr_ihe <span class="ot">&lt;-</span> bg_envt_ihe <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>x, <span class="sc">-</span>y)</span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-4"><a href="#cb89-4" aria-hidden="true" tabindex="-1"></a>usdm<span class="sc">::</span><span class="fu">vifstep</span>(bg_corr_ihe, <span class="at">th=</span><span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>13 variables from the 19 input variables have collinearity problem: 
 
bio6 bio11 bio10 bio16 bio1 bio12 bio2 bio17 bio4 bio13 bio19 bio5 bio15 

After excluding the collinear variables, the linear correlation coefficients ranges between: 
min correlation ( bio18 ~ bio14 ):  0.01500325 
max correlation ( bio9 ~ bio8 ):  0.7692181 

---------- VIFs of the remained variables -------- 
  Variables      VIF
1     bio14 5.733003
2     bio18 2.436903
3      bio3 4.584239
4      bio7 3.383648
5      bio8 3.822119
6      bio9 2.703539</code></pre>
</div>
</div>
<p>The final variable list: BIO3, BIO7, BIO8, BIO9, BIO14, BIO18</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a>predictors_ihe <span class="ot">&lt;-</span> predictors_ihe[[<span class="fu">c</span>(<span class="st">"bio3"</span>, <span class="st">"bio7"</span>, <span class="st">"bio8"</span>, <span class="st">"bio9"</span>, <span class="st">"bio14"</span>, <span class="st">"bio18"</span>)]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="maxent-model-3" class="level4">
<h4 class="anchored" data-anchor-id="maxent-model-3">Maxent model</h4>
<p>I’m using a jackknife model evaluation approach since I only have 26 observations.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">3398737</span>)</span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a>coords_ihe <span class="ot">&lt;-</span> <span class="fu">st_coordinates</span>(locs_ihe)</span>
<span id="cb92-3"><a href="#cb92-3" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(coords_ihe) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"x"</span>, <span class="st">"y"</span>)</span>
<span id="cb92-4"><a href="#cb92-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-5"><a href="#cb92-5" aria-hidden="true" tabindex="-1"></a>folds_ihe <span class="ot">&lt;-</span> ENMeval<span class="sc">::</span><span class="fu">get.jackknife</span>(<span class="at">occ =</span> coords_ihe, </span>
<span id="cb92-6"><a href="#cb92-6" aria-hidden="true" tabindex="-1"></a>                            <span class="at">bg =</span> bg_coords_ihe)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Run the model. Predictions are clamped to prevent extrapolation.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">19999923</span>)</span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a><span class="co"># the vector of regularization multipliers to test</span></span>
<span id="cb93-4"><a href="#cb93-4" aria-hidden="true" tabindex="-1"></a>rms <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="fl">0.5</span>, <span class="dv">5</span>, <span class="fl">0.5</span>)</span>
<span id="cb93-5"><a href="#cb93-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-6"><a href="#cb93-6" aria-hidden="true" tabindex="-1"></a><span class="co"># convert the terra object to a raster stack for use in EMNeval</span></span>
<span id="cb93-7"><a href="#cb93-7" aria-hidden="true" tabindex="-1"></a>predictors_ihe_stack <span class="ot">&lt;-</span> raster<span class="sc">::</span><span class="fu">stack</span>(predictors_ihe)</span>
<span id="cb93-8"><a href="#cb93-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-9"><a href="#cb93-9" aria-hidden="true" tabindex="-1"></a><span class="co"># iterate model building over all chosen parameter settings</span></span>
<span id="cb93-10"><a href="#cb93-10" aria-hidden="true" tabindex="-1"></a>sdm_ihe <span class="ot">&lt;-</span></span>
<span id="cb93-11"><a href="#cb93-11" aria-hidden="true" tabindex="-1"></a>  ENMeval<span class="sc">::</span><span class="fu">ENMevaluate</span>(</span>
<span id="cb93-12"><a href="#cb93-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">occs =</span> coords_ihe,</span>
<span id="cb93-13"><a href="#cb93-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">envs =</span> predictors_ihe_stack,</span>
<span id="cb93-14"><a href="#cb93-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">bg.coords =</span> bg_coords_ihe,</span>
<span id="cb93-15"><a href="#cb93-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">RMvalues =</span> rms,</span>
<span id="cb93-16"><a href="#cb93-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">fc =</span> <span class="fu">c</span>(<span class="st">'L'</span>, <span class="st">'LQ'</span>),</span>
<span id="cb93-17"><a href="#cb93-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># clamping to prevent model extrapolation</span></span>
<span id="cb93-18"><a href="#cb93-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">doClamp =</span> <span class="cn">TRUE</span>,</span>
<span id="cb93-19"><a href="#cb93-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">taxon.name =</span> <span class="st">"iheringii"</span>,</span>
<span id="cb93-20"><a href="#cb93-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">partitions =</span> <span class="st">"user"</span>,</span>
<span id="cb93-21"><a href="#cb93-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># going to do a separate run with the final model on testing data</span></span>
<span id="cb93-22"><a href="#cb93-22" aria-hidden="true" tabindex="-1"></a>    <span class="co">#occs.testing = test_ihe,</span></span>
<span id="cb93-23"><a href="#cb93-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">user.grp =</span> folds_ihe,</span>
<span id="cb93-24"><a href="#cb93-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">clamp =</span> <span class="cn">TRUE</span>,</span>
<span id="cb93-25"><a href="#cb93-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">algorithm =</span> <span class="st">"maxent.jar"</span>,</span>
<span id="cb93-26"><a href="#cb93-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">parallel =</span> <span class="cn">TRUE</span>,</span>
<span id="cb93-27"><a href="#cb93-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">numCores =</span> <span class="dv">6</span></span>
<span id="cb93-28"><a href="#cb93-28" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a><span class="co"># write the model to file</span></span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a><span class="fu">write_rds</span>(sdm_ihe, <span class="fu">here</span>(<span class="st">"analysis"</span>, <span class="st">"output"</span>, <span class="st">"sdm_models"</span>, <span class="st">"sdm_iheringii.rds"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">

</div>
<section id="model-evaluation-3" class="level5">
<h5 class="anchored" data-anchor-id="model-evaluation-3">Model evaluation</h5>
<p>Let’s take a look at the model results.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a>eval_table_ihe <span class="ot">&lt;-</span> sdm_ihe<span class="sc">@</span>results</span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a>eval_mods_ihe <span class="ot">&lt;-</span> sdm_ihe<span class="sc">@</span>models</span>
<span id="cb95-3"><a href="#cb95-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-4"><a href="#cb95-4" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(eval_mods_ihe) <span class="ot">&lt;-</span></span>
<span id="cb95-5"><a href="#cb95-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str_replace_all</span>(<span class="fu">names</span>(eval_mods_ihe), <span class="st">"</span><span class="sc">\\</span><span class="st">."</span>, <span class="st">"</span><span class="sc">\\</span><span class="st">_"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Select the final model. First I’m looking at plots of model evaluation stats to get an idea of the spread of stats.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a>daic_ihe <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> eval_table_ihe, <span class="fu">aes</span>(<span class="at">x =</span> rm, <span class="at">y =</span> delta.AICc, <span class="at">color =</span> fc)) <span class="sc">+</span></span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb96-3"><a href="#cb96-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_viridis_d</span>() <span class="sc">+</span></span>
<span id="cb96-4"><a href="#cb96-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb96-5"><a href="#cb96-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-6"><a href="#cb96-6" aria-hidden="true" tabindex="-1"></a>or_ihe <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> eval_table_ihe, <span class="fu">aes</span>(<span class="at">x =</span> rm, <span class="at">y =</span> or<span class="fl">.10</span>p.avg, <span class="at">color =</span> fc)) <span class="sc">+</span></span>
<span id="cb96-7"><a href="#cb96-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb96-8"><a href="#cb96-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_viridis_d</span>() <span class="sc">+</span></span>
<span id="cb96-9"><a href="#cb96-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb96-10"><a href="#cb96-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-11"><a href="#cb96-11" aria-hidden="true" tabindex="-1"></a>dauc_ihe <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> eval_table_ihe, <span class="fu">aes</span>(<span class="at">x =</span> rm, <span class="at">y =</span> auc.diff.avg, <span class="at">color =</span> fc)) <span class="sc">+</span></span>
<span id="cb96-12"><a href="#cb96-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb96-13"><a href="#cb96-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_viridis_d</span>() <span class="sc">+</span></span>
<span id="cb96-14"><a href="#cb96-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb96-15"><a href="#cb96-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-16"><a href="#cb96-16" aria-hidden="true" tabindex="-1"></a>(daic_ihe <span class="sc">+</span> or_ihe) <span class="sc">/</span> (dauc_ihe)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="species_distribution_modeling_files/figure-html/unnamed-chunk-90-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Now I’m going to take a look at tables of delta AICc, omission rate, and AUC to see how close the models are. All of the top models have the same omission rate, similar AUC, and are either LQ or L. I chose the simplest model within 2 AICc of the top model, which was the rm 2.5 and linear feature class model. The top was a rm 2.5 linear quadratic, but even marginally simpler is better within reasonable limits. After skimming through them, they are all very similar models.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a>eval_table_ihe <span class="sc">%&gt;%</span> </span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(delta.AICc, AICc, or<span class="fl">.10</span>p.avg, or.mtp.avg, auc.diff.avg, auc.val.avg, rm, fc) <span class="sc">%&gt;%</span></span>
<span id="cb97-3"><a href="#cb97-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(delta.AICc) <span class="sc">%&gt;%</span> </span>
<span id="cb97-4"><a href="#cb97-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">10</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb97-5"><a href="#cb97-5" aria-hidden="true" tabindex="-1"></a>  knitr<span class="sc">::</span><span class="fu">kable</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped">
<colgroup>
<col style="width: 14%">
<col style="width: 12%">
<col style="width: 14%">
<col style="width: 14%">
<col style="width: 17%">
<col style="width: 16%">
<col style="width: 5%">
<col style="width: 4%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: right;">delta.AICc</th>
<th style="text-align: right;">AICc</th>
<th style="text-align: right;">or.10p.avg</th>
<th style="text-align: right;">or.mtp.avg</th>
<th style="text-align: right;">auc.diff.avg</th>
<th style="text-align: right;">auc.val.avg</th>
<th style="text-align: left;">rm</th>
<th style="text-align: left;">fc</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">0.0000000</td>
<td style="text-align: right;">350.9994</td>
<td style="text-align: right;">0.16</td>
<td style="text-align: right;">0.12</td>
<td style="text-align: right;">0.1662477</td>
<td style="text-align: right;">0.7679014</td>
<td style="text-align: left;">1.5</td>
<td style="text-align: left;">L</td>
</tr>
<tr class="even">
<td style="text-align: right;">0.1545411</td>
<td style="text-align: right;">351.1540</td>
<td style="text-align: right;">0.16</td>
<td style="text-align: right;">0.08</td>
<td style="text-align: right;">0.1694758</td>
<td style="text-align: right;">0.7643897</td>
<td style="text-align: left;">2</td>
<td style="text-align: left;">LQ</td>
</tr>
<tr class="odd">
<td style="text-align: right;">0.7403935</td>
<td style="text-align: right;">351.7398</td>
<td style="text-align: right;">0.16</td>
<td style="text-align: right;">0.08</td>
<td style="text-align: right;">0.1676889</td>
<td style="text-align: right;">0.7625857</td>
<td style="text-align: left;">2.5</td>
<td style="text-align: left;">LQ</td>
</tr>
<tr class="even">
<td style="text-align: right;">1.4120727</td>
<td style="text-align: right;">352.4115</td>
<td style="text-align: right;">0.20</td>
<td style="text-align: right;">0.12</td>
<td style="text-align: right;">0.1653969</td>
<td style="text-align: right;">0.7608779</td>
<td style="text-align: left;">3</td>
<td style="text-align: left;">LQ</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2.1619731</td>
<td style="text-align: right;">353.1614</td>
<td style="text-align: right;">0.20</td>
<td style="text-align: right;">0.08</td>
<td style="text-align: right;">0.1648507</td>
<td style="text-align: right;">0.7590740</td>
<td style="text-align: left;">3.5</td>
<td style="text-align: left;">LQ</td>
</tr>
<tr class="even">
<td style="text-align: right;">2.4465226</td>
<td style="text-align: right;">353.4459</td>
<td style="text-align: right;">0.20</td>
<td style="text-align: right;">0.04</td>
<td style="text-align: right;">0.1716466</td>
<td style="text-align: right;">0.7628262</td>
<td style="text-align: left;">1.5</td>
<td style="text-align: left;">LQ</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2.9846966</td>
<td style="text-align: right;">353.9841</td>
<td style="text-align: right;">0.20</td>
<td style="text-align: right;">0.08</td>
<td style="text-align: right;">0.1643165</td>
<td style="text-align: right;">0.7572459</td>
<td style="text-align: left;">4</td>
<td style="text-align: left;">LQ</td>
</tr>
<tr class="even">
<td style="text-align: right;">3.5188323</td>
<td style="text-align: right;">354.5182</td>
<td style="text-align: right;">0.16</td>
<td style="text-align: right;">0.12</td>
<td style="text-align: right;">0.1638344</td>
<td style="text-align: right;">0.7653277</td>
<td style="text-align: left;">2</td>
<td style="text-align: left;">L</td>
</tr>
<tr class="odd">
<td style="text-align: right;">3.8682930</td>
<td style="text-align: right;">354.8677</td>
<td style="text-align: right;">0.12</td>
<td style="text-align: right;">0.04</td>
<td style="text-align: right;">0.1472209</td>
<td style="text-align: right;">0.7683584</td>
<td style="text-align: left;">5</td>
<td style="text-align: left;">L</td>
</tr>
<tr class="even">
<td style="text-align: right;">3.8763248</td>
<td style="text-align: right;">354.8757</td>
<td style="text-align: right;">0.20</td>
<td style="text-align: right;">0.08</td>
<td style="text-align: right;">0.1638314</td>
<td style="text-align: right;">0.7562357</td>
<td style="text-align: left;">4.5</td>
<td style="text-align: left;">LQ</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Select model.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a>mod_ihe <span class="ot">&lt;-</span> eval_mods_ihe<span class="sc">$</span>rm_2_fc_LQ</span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a>opt_seq_tune_ihe <span class="ot">&lt;-</span> eval_table_ihe<span class="sc">$</span>tune.args[eval_table_ihe<span class="sc">$</span>tune.args <span class="sc">==</span> <span class="st">"rm.2_fc.LQ"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Variable importance.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(mod_ihe)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="species_distribution_modeling_files/figure-html/var-importance-ihe-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a><span class="fu">png</span>(<span class="st">"variable_contribution_iheringii.png"</span>)</span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(mod_ihe)</span>
<span id="cb100-3"><a href="#cb100-3" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>()</span>
<span id="cb100-4"><a href="#cb100-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-5"><a href="#cb100-5" aria-hidden="true" tabindex="-1"></a><span class="fu">file.copy</span>(<span class="fu">here</span>(<span class="st">"variable_contribution_iheringii.png"</span>), <span class="fu">here</span>(<span class="st">"analysis"</span>, <span class="st">"output"</span>, <span class="st">"sdm_response_curves_variable_importance"</span>, <span class="st">"variable_contribution_iheringii.png"</span>))</span>
<span id="cb100-6"><a href="#cb100-6" aria-hidden="true" tabindex="-1"></a><span class="fu">file.remove</span>(<span class="fu">here</span>(<span class="st">"variable_contribution_iheringii.png"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Plot the response curves. In order: bio3, bio7^2, bio8, bio9, bio14^2, bio18.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a>dismo<span class="sc">::</span><span class="fu">response</span>(mod_ihe)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="species_distribution_modeling_files/figure-html/resp-curves-ihe-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a><span class="fu">png</span>(<span class="st">"response_curves_iheringii.png"</span>)</span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a>dismo<span class="sc">::</span><span class="fu">response</span>(mod_ihe)</span>
<span id="cb102-3"><a href="#cb102-3" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>()</span>
<span id="cb102-4"><a href="#cb102-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-5"><a href="#cb102-5" aria-hidden="true" tabindex="-1"></a><span class="fu">file.copy</span>(<span class="fu">here</span>(<span class="st">"response_curves_iheringii.png"</span>), <span class="fu">here</span>(<span class="st">"analysis"</span>, <span class="st">"output"</span>, <span class="st">"sdm_response_curves_variable_importance"</span>, <span class="st">"response_curves_iheringii.png"</span>))</span>
<span id="cb102-6"><a href="#cb102-6" aria-hidden="true" tabindex="-1"></a><span class="fu">file.remove</span>(<span class="fu">here</span>(<span class="st">"response_curves_iheringii.png"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="project-3" class="level5">
<h5 class="anchored" data-anchor-id="project-3">Project</h5>
<p>I’m projecting the model to the study area extent. It’s not predicting strong suitability for the southern localities. I’ll have to look at the genetic structure and locality info more closely to see what’s up with them.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a>pred_ihe <span class="ot">&lt;-</span> ENMeval<span class="sc">::</span><span class="fu">eval.predictions</span>(sdm_ihe)[[opt_seq_tune_ihe]]</span>
<span id="cb103-2"><a href="#cb103-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(pred_ihe)</span>
<span id="cb103-3"><a href="#cb103-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(af), <span class="at">add =</span> <span class="cn">TRUE</span>)</span>
<span id="cb103-4"><a href="#cb103-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(locs_ihe), <span class="at">pch =</span> <span class="dv">21</span>, <span class="at">bg =</span> <span class="fu">alpha</span>(<span class="st">"lightgray"</span>, <span class="fl">0.5</span>), <span class="at">add =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="species_distribution_modeling_files/figure-html/unnamed-chunk-97-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a>pred_ihe_thresh <span class="ot">&lt;-</span> pred_ihe<span class="sc">$</span>rm<span class="fl">.2</span>_fc.LQ</span>
<span id="cb104-2"><a href="#cb104-2" aria-hidden="true" tabindex="-1"></a><span class="co"># observed suitabilities</span></span>
<span id="cb104-3"><a href="#cb104-3" aria-hidden="true" tabindex="-1"></a>obs_suit_ihe <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">extract</span>(pred_ihe<span class="sc">$</span>rm<span class="fl">.2</span>_fc.LQ, locs_ihe)</span>
<span id="cb104-4"><a href="#cb104-4" aria-hidden="true" tabindex="-1"></a><span class="co"># minimum training presence</span></span>
<span id="cb104-5"><a href="#cb104-5" aria-hidden="true" tabindex="-1"></a>min_suit_ihe <span class="ot">&lt;-</span> <span class="fu">min</span>(obs_suit_ihe)</span>
<span id="cb104-6"><a href="#cb104-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-7"><a href="#cb104-7" aria-hidden="true" tabindex="-1"></a>pred_ihe_thresh[pred_ihe_thresh <span class="sc">&gt;=</span> min_suit_ihe] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb104-8"><a href="#cb104-8" aria-hidden="true" tabindex="-1"></a>pred_ihe_thresh[pred_ihe_thresh <span class="sc">&lt;</span> min_suit_ihe] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb104-9"><a href="#cb104-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-10"><a href="#cb104-10" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(pred_ihe_thresh)</span>
<span id="cb104-11"><a href="#cb104-11" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(af), <span class="at">add =</span> <span class="cn">TRUE</span>)</span>
<span id="cb104-12"><a href="#cb104-12" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(locs_ihe), <span class="at">pch =</span> <span class="dv">21</span>, <span class="at">bg =</span> <span class="fu">alpha</span>(<span class="st">"lightgray"</span>, <span class="fl">0.5</span>), <span class="at">add =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="species_distribution_modeling_files/figure-html/proj-cur-ihe-thresh-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
</section>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>